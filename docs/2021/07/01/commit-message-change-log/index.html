<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"><![endif]--> <!--[if IE 7]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if IE 8]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js" lang="zh"> <!--<![endif]--> <head> <meta charset="utf-8"> <!--[if IE]><meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'><![endif]--> <meta name="viewport" content="width=device-width,initial-scale=1"> <title>Commit message 和 Change log 编写指南 | 晨霜’s Blog</title> <meta name="generator" content="Jekyll v3.9.0"/> <meta property="og:title" content="Commit message 和 Change log 编写指南"/> <meta name="author" content="晨霜"/> <meta property="og:locale" content="zh"/> <meta name="description" content="工具安装实践 工具安装实践"/> <meta property="og:description" content="工具安装实践 工具安装实践"/> <link rel="canonical" href="https://empvalley.com/2021/07/01/commit-message-change-log/"/> <meta property="og:url" content="https://empvalley.com/2021/07/01/commit-message-change-log/"/> <meta property="og:site_name" content="晨霜’s Blog"/> <meta property="og:type" content="article"/> <meta property="article:published_time" content="2021-07-01T00:00:00-04:00"/> <meta name="twitter:card" content="summary"/> <meta property="twitter:title" content="Commit message 和 Change log 编写指南"/> <script type="application/ld+json">
{"@type":"BlogPosting","headline":"Commit message 和 Change log 编写指南","dateModified":"2021-07-01T00:00:00-04:00","datePublished":"2021-07-01T00:00:00-04:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://empvalley.com/2021/07/01/commit-message-change-log/"},"author":{"@type":"Person","name":"晨霜"},"url":"https://empvalley.com/2021/07/01/commit-message-change-log/","description":"工具安装实践 工具安装实践","@context":"https://schema.org"}</script> <meta name="keywords" content="Git"/> <link type="application/atom+xml" rel="alternate" href="https://empvalley.com/feed.xml" title="晨霜’s Blog"/> <link href='/assets/stylesheets/blog.css' rel="stylesheet" type="text/css"> <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script> <script>window.Modernizr||document.write('<script src="/assets/javascripts/modernizr-2.8.3.min.js"><\/script>');</script> <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> <script>window.jQuery||document.write('<script src="/assets/javascripts/jquery-3.3.1.min.js"><\/script>');</script> <script src="//cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script> <script>window.Pace||document.write('<script src="/assets/javascripts/pace.min.js"><\/script>');</script> <script>(function(b,m,h,a,g){b[a]=b[a]||[];b[a].push({"gtm.start":new Date().getTime(),event:"gtm.js"});var k=m.getElementsByTagName(h)[0],e=m.createElement(h),c=a!="dataLayer"?"&l="+a:"";e.async=true;e.src="https://www.googletagmanager.com/gtm.js?id="+g+c;k.parentNode.insertBefore(e,k)})(window,document,"script","dataLayer","GTM-WLHQF68");</script> </head> <body> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WLHQF68" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript> <!--[if IE]><p class="site-notice">您正在使用一个过时的网页浏览器。请<a href="http://browsehappy.com/" target="_blank">升级您的浏览器</a>或<a href="http://www.google.com/chromeframe/?redirect=true" target="_blank">开启 Google Chrome Frame</a> 来提高用户体验。</p><![endif]--> <noscript> <p class="site-notice">本网站需要 JavaScript。请查阅指南来<a href="http://www.enable-javascript.com/" target="_blank">给您的浏览器开启 JavaScript 功能</a>。</p> </noscript> <div class="nav-wrapper overlay-wrapper"> <div class="nav-form overlay-form"> <span class="overlay-header menu">菜单</span> <a class="btn-close">关闭</a> <div class="results"> <ul> <li><a href="/blog/categories/">文章分类</a></li> <li><a href="/blog/tags/">文章标签</a></li> <li><a href="/">关于</a></li> </ul> </div> </div> </div> <div class="search-wrapper overlay-wrapper"> <div class="search-form overlay-form"> <input type="text" class="overlay-header search-field" placeholder="搜索..."> <a class="btn-close">关闭</a> <ul class="results"></ul> </div> </div> <div id="page" class="hentry"> <header class="the-header"> <div class="unit-head"> <div class="unit-inner unit-head-inner"> <nav class="nav-global"> <ul> <li class="logo nav-link"> <button class="btn-menu" title="菜单"></button> <a href="/blog/">晨霜’s Blog</a> <!--[if !IE]>--> <button class="btn-search" title="搜索"></button> <!--<![endif]--> </li> <li class="nav-link"><a title="文章分类" href="/blog/categories/">文章分类</a></li> <li class="nav-link"><a title="文章标签" href="/blog/tags/">文章标签</a></li> <!--[if !IE]>--> <li class="nav-link"><a title="搜索" class="btn-search" href="#">搜索</a></li> <!--<![endif]--> </ul> </nav> </div> </div> </header> <div class="body animated fadeInDown" role="main"> <div class="unit-body"> <div class="unit-inner unit-body-inner"> <div class="entry-content"> <article class="unit-article layout-post"> <div class="unit-inner unit-article-inner"> <div itemscope itemtype="http://schema.org/Article" class="content"> <header> <div class="unit-head"> <div class="unit-inner unit-head-inner"> <h1 class="entry-title" itemprop="name">Commit message 和 Change log 编写指南</h1> </div> </div> </header> <div class="bd article-content"> <div class="entry-content"> <div class="meta"> <p class="date-publish"> 发表信息: <time itemprop="datePublished" class="date-pub updated" title="2021-07-01T00:00:00-04:00" datetime="2021-07-01T00:00:00-04:00">July 01, 2021 </time> by <a class="author" href="/" rel="author" title="显示作者"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name">晨霜</span> </span> </a> <a class="license-icon" rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" title="显示许可证"> <img alt="Creative Commons Licence" style="border-width:0" src="/assets/images/theme/cc-by-sa.png" height="16" width="80"/> </a> </p> <ul class="list-category list-linear"> <li class="list-head">文章分类: </li> <li> <a href="/blog/categories/#技术" title="技术"> 技术 <span>40</span></a> </li> </ul> <ul class="list-tag list-linear"> <li class="list-head">文章标签: </li> <li> <a href="/blog/tags/#Git" title="Git">Git <span>3</span></a> </li> </ul> </div> <div itemprop="articleBody"> <ul class="toc" id="markdown-toc"> <li><a href="#heading-工具安装实践" id="markdown-toc-heading-工具安装实践">工具安装实践</a> <ul> <li><a href="#heading-idea-中安装使用-git-commit-template-插件" id="markdown-toc-heading-idea-中安装使用-git-commit-template-插件">Idea 中安装使用 Git Commit Template 插件</a></li> <li><a href="#heading-配置-gitignore-忽略安装工具产生的文件" id="markdown-toc-heading-配置-gitignore-忽略安装工具产生的文件">配置 .gitignore 忽略安装工具产生的文件</a></li> <li><a href="#heading-commitizen-工具的安装" id="markdown-toc-heading-commitizen-工具的安装">Commitizen 工具的安装</a></li> <li><a href="#heading-change-log-工具的安装" id="markdown-toc-heading-change-log-工具的安装">Change log 工具的安装</a></li> <li><a href="#heading-validate-commit-msg-工具的安装" id="markdown-toc-heading-validate-commit-msg-工具的安装">validate-commit-msg 工具的安装</a></li> </ul> </li> <li><a href="#heading-git-commit-命令" id="markdown-toc-heading-git-commit-命令">Git commit 命令</a></li> <li><a href="#heading-一commit-message-的作用" id="markdown-toc-heading-一commit-message-的作用">一、Commit message 的作用</a></li> <li><a href="#heading-二commit-message-的格式" id="markdown-toc-heading-二commit-message-的格式">二、Commit message 的格式</a> <ul> <li><a href="#heading-21-header" id="markdown-toc-heading-21-header">2.1 Header</a></li> <li><a href="#heading-22-body" id="markdown-toc-heading-22-body">2.2 Body</a></li> <li><a href="#heading-23-footer" id="markdown-toc-heading-23-footer">2.3 Footer</a></li> <li><a href="#heading-24-revert" id="markdown-toc-heading-24-revert">2.4 Revert</a></li> </ul> </li> <li><a href="#heading-三commitizen" id="markdown-toc-heading-三commitizen">三、Commitizen</a></li> <li><a href="#heading-四validate-commit-msg" id="markdown-toc-heading-四validate-commit-msg">四、validate-commit-msg</a></li> <li><a href="#heading-五生成-change-log" id="markdown-toc-heading-五生成-change-log">五、生成 Change log</a></li> </ul> <h2 id="heading-工具安装实践">工具安装实践</h2> <p>这篇文章主要内容来源为阮一峰老师的博客。</p> <p>在参照文章中的工具安装步骤进行实操时，遇到一些问题，这里记录一下成功安装的过程，方便以后在新的环境中可以直接依照以下步骤安装。</p> <p>而实际工作中，可直接在 IDE 中安装支持 Angular 规范的插件而无须使用命令行的方式。</p> <p>例如接下来笔者要介绍的在 Idea 中安装使用 Git Commit Template 插件。</p> <h3 id="heading-idea-中安装使用-git-commit-template-插件">Idea 中安装使用 Git Commit Template 插件</h3> <ol> <li> <p>Ctrl + Shift + a 打开 Idea 中的插件商店。</p> </li> <li> <p>输入 Git Commit Template，选中安装。</p> </li> <li> <p>Ctrl + K 快捷键或是点击 Git 提交代码按钮，如下图：</p> <p><img src="https://empvalley.com/assets/images/posts/git-commit-template.png" alt=""/></p> </li> <li> <p>点击 Git Commit Template 插件提供的 Create commit message 按钮，填写提交信息 &gt; OK &gt; Commit，如图：</p> <p><img src="https://empvalley.com/assets/images/posts/git-commit-template2.png" alt=""/></p> </li> </ol> <h3 id="heading-配置-gitignore-忽略安装工具产生的文件">配置 .gitignore 忽略安装工具产生的文件</h3> <p>.gitignore 文件中添加如下内容：</p> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>node_modules
package.json
package-lock.json
</code></pre></div></div> <h3 id="heading-commitizen-工具的安装">Commitizen 工具的安装</h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 安装 commitizen 工具</span>
<span class="nv">$ </span>npm <span class="nb">install</span> <span class="nt">-g</span> commitizen
<span class="c"># 创建一个空的 package.json 文件</span>
<span class="nv">$ </span>npm init <span class="nt">--yes</span>
<span class="c"># 使项目支持 Angular 的 Commit message 格式</span>
<span class="nv">$ </span>commitizen init cz-conventional-changelog <span class="nt">--save</span> <span class="nt">--save-exact</span>
</code></pre></div></div> <p>以后，凡是用到 <strong>git commit</strong> 命令，一律改为使用 <strong>git cz</strong>。这时，就会出现选项，用来生成符合格式的 Commit message。</p> <h3 id="heading-change-log-工具的安装">Change log 工具的安装</h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 安装 Change log 工具</span>
<span class="nv">$ </span>npm <span class="nb">install</span> <span class="nt">-g</span> conventional-changelog-cli
<span class="c"># 使用 Change log 工具生成 CHANGELOG.md 文件</span>
<span class="nv">$ </span>conventional-changelog <span class="nt">-p</span> angular <span class="nt">-i</span> CHANGELOG.md <span class="nt">-s</span>
</code></pre></div></div> <h3 id="heading-validate-commit-msg-工具的安装">validate-commit-msg 工具的安装</h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 安装 ghooks</span>
<span class="nv">$ </span>npm <span class="nb">install </span>ghooks <span class="nt">--save-dev</span>
<span class="c"># 安装 validate-comit-msg</span>
npm <span class="nb">install</span> <span class="nt">--save-dev</span> validate-commit-msg
<span class="c"># 在 package.json 文件中增加如下配置</span>
<span class="s2">"config"</span>: <span class="o">{</span>
    <span class="s2">"ghooks"</span>: <span class="o">{</span>
      <span class="s2">"commit-msg"</span>: <span class="s2">"validate-commit-msg"</span>
    <span class="o">}</span>
  <span class="o">}</span>
</code></pre></div></div> <blockquote> <p>该工具每次 <strong>git commit</strong> 时自动检查 Commit message 是否合格。而 Commitizen 工具使用时执行的是 <strong>git cz</strong> 命令，因此在实际工作中并没有使用到该工具。</p> </blockquote> <h2 id="heading-git-commit-命令">Git commit 命令</h2> <p>Git 每次提交代码，都要写 Commit message（提交说明），否则就不允许提交。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git commit <span class="nt">-m</span> <span class="s2">"hello world"</span>
</code></pre></div></div> <p>上面代码的 <strong>-m</strong> 参数，就是用来指定 commit mesage 的。</p> <p>如果一行不够，可以只执行 <strong>git commit</strong>，就会跳出文本编辑器，让你写多行。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git commit
</code></pre></div></div> <p>基本上，你写什么都行（<a href="http://www.commitlogsfromlastnight.com/">这里</a>，<a href="http://blog.no-panic.at/2014/10/20/funny-initial-git-commit-messages/">这里</a>和<a href="http://whatthecommit.com/">这里</a>）。</p> <p><img src="https://empvalley.com/assets/images/posts/bg2016010601.png" alt=""/></p> <p>但是，一般来说，commit message 应该清晰明了，说明本次提交的目的。</p> <p><img src="https://empvalley.com/assets/images/posts/bg2016010602.png" alt=""/></p> <p>目前，社区有多种 Commit message 的<a href="https://github.com/ajoslin/conventional-changelog/blob/master/conventions">写法规范</a>。本文介绍<a href="https://docs.google.com/document/d/1QrDFcIiPjSLDn3EL15IJygNPiHORgU1_OOAqWjiDU5Y/edit#heading=h.greljkmo14y0">Angular 规范</a>（见上图），这是目前使用最广的写法，比较合理和系统化，并且有配套的工具。</p> <h2 id="heading-一commit-message-的作用">一、Commit message 的作用</h2> <p>格式化的Commit message，有几个好处。</p> <p><strong>（1）提供更多的历史信息，方便快速浏览。</strong></p> <p>比如，下面的命令显示上次发布后的变动，每个commit占据一行。你只看行首，就知道某次 commit 的目的。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git log &lt;last tag&gt; HEAD <span class="nt">--pretty</span><span class="o">=</span>format:%s
</code></pre></div></div> <p><img src="https://empvalley.com/assets/images/posts/bg2016010604.png" alt=""/></p> <p><strong>（2）可以过滤某些commit（比如文档改动），便于快速查找信息。</strong></p> <p>比如，下面的命令仅仅显示本次发布新增加的功能。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git log &lt;last release&gt; HEAD <span class="nt">--grep</span> feature
</code></pre></div></div> <p><strong>（3）可以直接从commit生成Change log。</strong></p> <p>Change Log 是发布新版本时，用来说明与上一个版本差异的文档，详见后文。</p> <p><img src="https://empvalley.com/assets/images/posts/bg2016010603.png" alt=""/></p> <h2 id="heading-二commit-message-的格式">二、Commit message 的格式</h2> <p>每次提交，Commit message 都包括三个部分：Header，Body 和 Footer。</p> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;type&gt;</span>(<span class="nt">&lt;scope&gt;</span>): <span class="nt">&lt;subject&gt;</span>
// 空一行
<span class="nt">&lt;body&gt;</span>
// 空一行
<span class="nt">&lt;footer&gt;</span>
</code></pre></div></div> <p>其中，Header 是必需的，Body 和 Footer 可以省略。</p> <p>不管是哪一个部分，任何一行都不得超过72个字符（或100个字符）。这是为了避免自动换行影响美观。</p> <h3 id="heading-21-header">2.1 Header</h3> <p>Header部分只有一行，包括三个字段：<strong>type</strong>（必需）、scope（可选）和<strong>subject</strong>（必需）。</p> <h4 id="heading-1type">（1）type</h4> <p><strong>type</strong>用于说明 commit 的类别，只允许使用下面7个标识。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>feat：新功能（feature）
fix：修补bug
docs：文档（documentation）
style： 格式（不影响代码运行的变动）
refactor：重构（即不是新增功能，也不是修改bug的代码变动）
<span class="nb">test</span>：增加测试
chore：构建过程或辅助工具的变动
</code></pre></div></div> <p>如果<strong>type</strong>为<strong>feat</strong>和<strong>fix</strong>，则该 commit 将肯定出现在 Change log 之中。其他情况（<strong>docs</strong>、<strong>chore</strong>、<strong>style</strong>、<strong>refactor</strong>、<strong>test</strong>）由你决定，要不要放入 Change log，建议是不要。</p> <h4 id="heading-2scope">（2）scope</h4> <p><strong>scope</strong>用于说明 commit 影响的范围，比如数据层、控制层、视图层等等，视项目不同而不同。</p> <h4 id="heading-3subject">（3）subject</h4> <p><strong>subject</strong>是 commit 目的的简短描述，不超过50个字符。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>以动词开头，使用第一人称现在时，比如change，而不是changed或changes
第一个字母小写
结尾不加句号（.）
</code></pre></div></div> <h3 id="heading-22-body">2.2 Body</h3> <p>Body 部分是对本次 commit 的详细描述，可以分成多行。下面是一个范例。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>More detailed explanatory text, <span class="k">if </span>necessary.  Wrap it to 
about 72 characters or so. 

Further paragraphs come after blank lines.

- Bullet points are okay, too
- Use a hanging indent
</code></pre></div></div> <p>有两个注意点。</p> <p>（1）使用第一人称现在时，比如使用<strong>change</strong>而不是<strong>changed</strong>或<strong>changes</strong>。</p> <p>（2）应该说明代码变动的动机，以及与以前行为的对比。</p> <h3 id="heading-23-footer">2.3 Footer</h3> <p>Footer 部分只用于两种情况。</p> <p><strong>（1）不兼容变动</strong></p> <p>如果当前代码与上一个版本不兼容，则 Footer 部分以<strong>BREAKING CHANGE</strong>开头，后面是对变动的描述、以及变动理由和迁移方法。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BREAKING CHANGE: isolate scope bindings definition has changed.

    To migrate the code follow the example below:

    Before:

    scope: <span class="o">{</span>
      myAttr: <span class="s1">'attribute'</span>,
    <span class="o">}</span>

    After:

    scope: <span class="o">{</span>
      myAttr: <span class="s1">'@'</span>,
    <span class="o">}</span>

    The removed <span class="sb">`</span>inject<span class="sb">`</span> wasn<span class="s1">'t generaly useful for directives so there should be no code using it.
</span></code></pre></div></div> <p><strong>（2）关闭 Issue</strong></p> <p>如果当前 commit 针对某个issue，那么可以在 Footer 部分关闭这个 issue 。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Closes <span class="c">#234</span>
</code></pre></div></div> <p>也可以一次关闭多个 issue 。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Closes <span class="c">#123, #245, #992</span>
</code></pre></div></div> <h3 id="heading-24-revert">2.4 Revert</h3> <p>还有一种特殊情况，如果当前 commit 用于撤销以前的 commit，则必须以 <strong>revert:</strong> 开头，后面跟着被撤销 Commit 的 Header。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>revert: feat<span class="o">(</span>pencil<span class="o">)</span>: add <span class="s1">'graphiteWidth'</span> option

This reverts commit 667ecc1654a317a13331b17617d973392f415f02.
</code></pre></div></div> <p>Body部分的格式是固定的，必须写成 <strong>This reverts commit &lt;hash&gt;.</strong>，其中的 <strong>hash</strong> 是被撤销 commit 的 SHA 标识符。</p> <p>如果当前 commit 与被撤销的 commit，在同一个发布（release）里面，那么它们都不会出现在 Change log 里面。如果两者在不同的发布，那么当前 commit，会出现在 Change log 的 <strong>Reverts</strong> 小标题下面。</p> <h2 id="heading-三commitizen">三、Commitizen</h2> <p><a href="https://github.com/commitizen/cz-cli">Commitizen</a> 是一个撰写合格 Commit message 的工具。</p> <p>安装命令如下。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm <span class="nb">install</span> <span class="nt">-g</span> commitizen
</code></pre></div></div> <p>然后，在项目目录里，运行下面的命令，使其支持 Angular 的 Commit message 格式。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>commitizen init cz-conventional-changelog <span class="nt">--save</span> <span class="nt">--save-exact</span>
</code></pre></div></div> <p>以后，凡是用到 <strong>git commit</strong> 命令，一律改为使用 <strong>git cz</strong>。这时，就会出现选项，用来生成符合格式的 Commit message。</p> <p><img src="https://empvalley.com/assets/images/posts/bg2016010605.png" alt=""/></p> <h2 id="heading-四validate-commit-msg">四、validate-commit-msg</h2> <p><strong>validate-commit-msg</strong> 用于检查 Node 项目的 Commit message 是否符合格式。</p> <p>它的安装是手动的。首先，拷贝下面这个<a href="https://github.com/kentcdodds/validate-commit-msg/blob/master/index.js">JS文件</a>，放入你的代码库。文件名可以取为 <strong>validate-commit-msg.js</strong>。</p> <p>接着，把这个脚本加入 Git 的 hook。下面是在 <strong>package.json</strong> 里面使用 <a href="http://npm.im/ghooks">ghooks</a>，把这个脚本加为 <strong>commit-msg</strong> 时运行。</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"ghooks"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"commit-msg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"./validate-commit-msg.js"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>然后，每次 <strong>git commit</strong> 的时候，这个脚本就会自动检查 Commit message 是否合格。如果不合格，就会报错。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git add <span class="nt">-A</span> 
<span class="nv">$ </span>git commit <span class="nt">-m</span> <span class="s2">"edit markdown"</span> 
INVALID COMMIT MSG: does not match <span class="s2">"&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;"</span> <span class="o">!</span> was: edit markdown
</code></pre></div></div> <h2 id="heading-五生成-change-log">五、生成 Change log</h2> <p>如果你的所有 Commit 都符合 Angular 格式，那么发布新版本时， Change log 就可以用脚本自动生成（例1，例2，例3）。</p> <p>生成的文档包括以下三个部分。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>New features
Bug fixes
Breaking changes.
</code></pre></div></div> <p>每个部分都会罗列相关的 commit ，并且有指向这些 commit 的链接。当然，生成的文档允许手动修改，所以发布前，你还可以添加其他内容。</p> <p><a href="https://github.com/ajoslin/conventional-changelog">conventional-changelog</a> 就是生成 Change log 的工具，运行下面的命令即可。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm <span class="nb">install</span> <span class="nt">-g</span> conventional-changelog
<span class="nv">$ </span><span class="nb">cd </span>my-project
<span class="nv">$ </span>conventional-changelog <span class="nt">-p</span> angular <span class="nt">-i</span> CHANGELOG.md <span class="nt">-w</span>
</code></pre></div></div> <p>上面命令不会覆盖以前的 Change log，只会在 <strong>CHANGELOG.md</strong> 的头部加上自从上次发布以来的变动。</p> <p>如果你想生成所有发布的 Change log，要改为运行下面的命令。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>conventional-changelog <span class="nt">-p</span> angular <span class="nt">-i</span> CHANGELOG.md <span class="nt">-w</span> <span class="nt">-r</span> 0
</code></pre></div></div> <p>为了方便使用，可以将其写入 <strong>package.json</strong> 的 <strong>scripts</strong> 字段。</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"changelog"</span><span class="p">:</span><span class="w"> </span><span class="s2">"conventional-changelog -p angular -i CHANGELOG.md -w -r 0"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>以后，直接运行下面的命令即可。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm run changelog
</code></pre></div></div> <hr/> <p>参考：</p> <p><a href="http://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html">Commit message 和 Change log 编写指南</a></p> </div> </div> </div> <footer class="unit-foot"> <div class="unit-inner unit-foot-inner"> <div class="post-buttons"> <a class="internal gotop" href="#page" title="返回顶部">返回顶部</a> <div class="addthis_toolbox addthis_default_style addthis_32x32_style"> <small class="label">分享本文：</small> <a class="btn-share-post addthis_button_email"></a> <a class="btn-share-post addthis_button_facebook"></a> <a class="btn-share-post addthis_button_google_plusone_share"></a> <a class="btn-share-post addthis_button_reddit"></a> <a class="btn-share-post addthis_button_twitter"></a> </div> <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5fd67ed699f02738"></script> </div> <nav class="pagination"> <a class="internal" rel="prev" href="/2021/06/26/blocked-mirror-for-repositories-of-maven/" title="上一篇 '解决 Maven 仓库镜像被锁定'"> ← 解决 Maven 仓库镜像被锁定</a> <a class="internal" rel="next" href="/2021/08/02/mysql-cte/" title="下一篇 'Mysql CTE'">Mysql CTE → </a> </nav> </div> </footer> <div class="misc-content"> <script>$(document).ready(function(){var b="CefuUqy9qWjTPQyiiLRTCFkFAOl7FIXLjBHyIdpFqMFDFYgqYgOHvaJIZXybCUV4";var c="fighting-v";var a="link:"+$(".comments .show-hidden").attr("data-disqus-url");$.ajax({type:"GET",url:"//disqus.com/api/3.0/threads/set.jsonp",data:{api_key:b,forum:c,thread:a},cache:false,dataType:"jsonp",success:function(d){if(d.response.length===1){btnText="显示评论 ("+d.response[0].posts+")";$(".comments .show-hidden").html(btnText)}}});$(".comments .show-hidden").on("click",function(){$.ajaxSetup({cache:true});$.getScript("//"+c+".disqus.com/embed.js");$.ajaxSetup({cache:false});$(this).remove()});if(/\#comments/.test(location.hash)){$(".comments .show-hidden").trigger("click")}});</script> <div class="comments"> <button class="center-block show-hidden" title="显示评论" data-disqus-url="https://empvalley.com/2021/07/01/commit-message-change-log/">显示评论</button> <div id="disqus_thread"></div> </div> </div> </div> </div> </article> </div> </div> </div> </div> <footer class="the-footer"> <div class="unit-foot"> <div class="unit-inner unit-foot-inner"> <div class="misc vcard"> <div class="about"> <h4><a href="/">关于</a></h4> <p>晨霜，软件开发，深圳</p> <p><small>本博客主题 <a href="https://github.com/yizeng/jekyll-theme-simple-texture" target="_blank">Simple Texture</a> 由 <a href="http://yizeng.me" target="_blank">Yi Zeng</a> 基于 <a href="https://jekyllrb.com/" target="_blank">Jekyll</a> 开发.</small></p> </div> <div class="social-links"> <a class="ico-rss" href="/feed.xml" rel="me" target="_blank" title="feed"></a> <a class="ico-github" href="https://github.com/v191211/" rel="me" target="_blank" title="github"></a> <a class="ico-linkedin" href="https://www.linkedin.com/in/fighting-v/" rel="me" target="_blank" title="linkedin"></a> <a class="ico-stackoverflow" href="https://stackoverflow.com/users/4612522/adam-smith" rel="me" target="_blank" title="stackoverflow"></a> </div> </div> </div> </div> <a href="#" class="internal back-to-top">返回顶部</a> </footer> </div> <script>$(document).ready(function(){var c=50,b=500,a=960;$(window).scroll(function(){if($(window).width()>a){if($(this).scrollTop()>c){$("footer").css("top","20px");$("footer .back-to-top").fadeIn(b)}else{$("footer").css("top","auto");$("footer .back-to-top").fadeOut(b)}}});$(window).resize(function(){if($(window).width()<a){$("footer").css("top","auto");$("footer .back-to-top").fadeOut(b)}if($(window).width()>=a&&$(this).scrollTop()>c){$("footer").css("top","20px");$("footer .back-to-top").fadeIn(b)}});$("footer .back-to-top, .gotop").on("click",function(d){d.preventDefault();$("html, body").animate({scrollTop:0},b);return false});$(".show-hidden").on("click",function(){$(this).parent().next().toggleClass("hidden");$(this).toggleClass("hidden")})});</script> <script src="/assets/javascripts/jekyll-search.jquery.js"></script> <script>$(document).ready(function(){$(".search-field").simpleJekyllSearch({jsonFile:"/search.json",template:'<li><a href="{url}">{title} <span class="entry-date"><time datetime="{date}">{shortdate}</time></span></a></li>',searchResults:".search-wrapper .results",searchResultsTitle:"<h4>搜索结果</h4>",noResults:"<p>啊哈<br/><small>什么也没找到 :(</small></p>"})});(function(c,b,d){var a=function(){c(".nav-wrapper, .search-wrapper").removeAttr("style");c(".nav-form, .search-form").removeClass("active");c("body").removeClass("nav-overlay search-overlay")};c(".nav-global .btn-search").on("click",function(){c(".search-wrapper").css({display:"block"});c(".search-form").addClass("active");c(".search-form").find("input").focus();c("body").addClass("search-overlay")});c(".nav-global .btn-menu").on("click",function(){c(".nav-wrapper").css({display:"block"});c(".nav-form").addClass("active");c(".nav-form .search-field").prop("disabled",true);c("body").addClass("nav-overlay")});c(".nav-wrapper .btn-close, .search-wrapper .btn-close").on("click",function(){a()});c(document).on("keyup",function(f){if(f.keyCode===27){a()}})})(jQuery,window);</script> <script src='//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.js'></script> <script src='//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-buttons.min.js'></script> <script src="/assets/javascripts/unveil/jquery.unveil.min.js"></script> <script>window.jQuery.fancybox||document.write('<script src="/assets/javascripts/fancybox/jquery.fancybox.pack.js?v=2.1.4"><\/script>');window.jQuery.fancybox.helpers.buttons||document.write('<script src="/assets/javascripts/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"><\/script>');</script> <script>$("head").append('<link rel="stylesheet" href="/assets/javascripts/fancybox/jquery.fancybox.css?v=2.1.4" type="text/css" />');$("head").append('<link rel="stylesheet" href="/assets/javascripts/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" />');$(".post-image").fancybox({prevEffect:"none",nextEffect:"none",closeBtn:true,helpers:{title:{type:"float"}}});$(document).ready(function(){$(".post-image > img").unveil(450)});</script> </body> </html>