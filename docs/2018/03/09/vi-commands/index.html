<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"><![endif]--> <!--[if IE 7]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if IE 8]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js" lang="zh"> <!--<![endif]--> <head> <meta charset="utf-8"> <!--[if IE]><meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'><![endif]--> <meta name="viewport" content="width=device-width,initial-scale=1"> <title>vi 常用命令 | 晨霜’s Blog</title> <meta name="generator" content="Jekyll v3.9.0"/> <meta property="og:title" content="vi 常用命令"/> <meta name="author" content="晨霜"/> <meta property="og:locale" content="zh"/> <meta name="description" content="为什么我们应该学习 vi 背景介绍 启动和停止 vi 创建新文件 插入模式 保存我们的工作 移动光标 基本编辑 追加文本 打开一行 删除文本 剪切，复制和粘贴文本 连接行 查找和替换 查找一行 查找整个文件 全局查找和替代 编辑多个文件 文件之间转换 打开编辑额外的文件 从一个文件复制内容到另一个文件 插入整个文件到另一个文件 保存工作 拓展阅读 为什么我们应该学习 vi 在现在这个图形编辑器和易于使用的基于文本编辑器的时代，比如说 nano，为什么我们还 应该学习 vi 呢？下面有三个充分的理由： vi 很多系统都预装。 如果我们的系统没有图形界面，比方说一台远端服务器或者是一个 X 配置损坏了的本地系统，那么 vi 就成了我们的救星。 虽然 nano 逐渐流行起来，但是它还没有普及。 POSIX，这套 Unix 系统中程序兼容的标准，就要求系统要预装 vi。 vi 是轻量级且执行快速的编辑器。 对于许多任务来说，启动 vi 比起在菜单中找到一个图形化文本编辑器，再等待编辑器数倍兆字节的数据加载而言，要容易的多。 另外，vi 是为了加快输入速度而设计的。 我们将会看到，当一名熟练的 vi 用户在编辑文件时，他或她的手从不需要移开键盘。 我们不希望其他 Linux 和 Unix 用户把我们看作胆小鬼 好吧，可能只有两个充分的理由。 背景介绍 第一版 vi 是在 1976 由 Bill Joy 写成的，当时他是加州大学伯克利分校的学生，后来他共同创建了 Sun 微系统公司。 vi 这个名字来源于单词 &quot;visual&quot;，因为它打算在带有可移动光标的视频终端上编辑文本。 在发明可视化编辑器之前，有一次只能操作一行文本的行编辑器。为了指定一个修改，我们告诉行编辑器到一个特殊行并且说明做什么修改，比方说添加或删除文本。 视频终端 (而不是基于打印机的终端，像电传打印机) 的出现，可视化编辑成为可能。 vi 实际上整合了一个强大的叫做 ex 行编辑器，所以我们在使用 vi 时能运行行编辑命令。 启动和停止 vi 启动 vi: vi 停止 vi: :q 强制退出: q! 注意：冒号是命令的一部分 小贴士：如果你在 vi 中 &quot;迷失&quot; 了，试着按下 Esc 键两次来找到路(回到普通模式)。 创建新文件 启动 vi 时, 传递给 vi 一个不存在的文件名，就创建了一个新文件： vi foo.txt 每行开头的波浪号 (&quot;~&quot;) 指示那一行不存在文本，这表示我们有一个空文件，还没有输入 任何字符。 小贴士：vi 是一个模式编辑器。 当 vi 启动后，进入的是命令模式；这种模式下，几乎每个按键都是一个命令，所以如果 我们打算输入字符，vi 会发疯，弄得一团糟。 插入模式 为了在文件中添加文本，首先我们必须进入插入模式。 按下 &quot;i&quot; 按键进入插入模式，现在我们能输入一些文本了，试着输入这些文本： The quick brown fox jumped over the lazy dog. 按下 Esc 按键, 退出插入模式并返回命令模式。 保存我们的工作 为了保存我们刚才对文件所做的修改，我们必须在命令模式下输入一个 ex 命令，通过按下 &quot;:&quot; 键，这很容易完成。 按下冒号键之后，一个冒号字符应该出现在屏幕的底部： : 为了写入我们修改的文件，我们在冒号之后输入 &quot;w&quot; 字符，然后按下回车键: :w 文件将会写入到硬盘，并且我们应该在屏幕底部得到一个确认信息，就像这样： &quot;foo.txt&quot; [New] 1L, 46C written 小贴示：如果你阅读 vim 的文档，你注意到 (混淆地) 命令模式被叫做普通模式，ex 命令叫做命令模式，当心。 移动光标 当在 vi 命令模式下时，vi 提供了大量的移动命令，其中一些是与 less 阅读器共享的。这里列举了一些： 按键 移动光标 l 或 右箭头 向右移动一个字符 h 或 左箭头 向左移动一个字符 j 或 下箭头 向下移动一行 k 或 上箭头 向上移动一行 0 (零按键) 移动到当前行的行首 ˆ 移动到当前行的第一个非空字符 $ 移动到当前行的末尾 w 移动到下一个单词或标点符号的开头 W 移动到下一个单词的开头, 忽略标点符号 b 移动到上一个单词或标点符号的开头 B 移动到上一个单词的开头, 忽略标点符号 Ctrl-f 或 Page Down 向下翻一页 Ctrl-b 或 Page Up 向上翻一页 numberG 移动到第 number 行. 例如: 1G 移动到文件的第一行 g 移动到文件的开端 G 移动到文件末尾 为什么 h、j、k 和 l 按键被用来移动光标呢？ 因为在开发 vi 之初，并不是所有的视频终端都有箭头按键，熟练的打字员可以使用规则的键盘按键来移动光标，他们的手从不需要移开键盘。 vi 中的许多命令都可以在前面加上一个数字，比方说上面提到的 &quot;G&quot; 命令，在命令之前加上一个数字，我们就可以指定命令执行的次数。 例如，命令 &quot;5j&quot; 导致 vi 向下移动 5 行。 基本编辑 大多数编辑工作由一些基本的操作组成，比如说插入文本，删除文本和通过剪切和粘贴来移动文本。 vi，当然以它自己的独特方式来支持所有的操作。 vi 也提供了有限的撤销形式；如果我们按下 &quot;u&quot; 按键，当在命令模式下，vi 将会撤销你所做的最后一次修改，当我们试着执行一些基本的编辑命令时，这会很方便。 追加文本 vi 有几种不同进入插入模式的方法。我们已经使用了 i 命令来插入文本，让我们返回到我们的 foo.txt 文件中, 呆一会儿。 The quick brown fox jumped over the lazy dog 如果我们想要在这个句子的末尾添加一些文本，我们会发现 i 命令不能完成任务，因为我们 不能把光标移到行尾。 vi 提供了追加文本的命令，明智地命名为 a 命令，如果我们把光标移动到行尾，输入 a 光标就会越过行尾，vi 进入插入模式。这样就允许我们添加更多的文本。 The quick brown fox jumped over the lazy dog. It was cool. 记住按下 Esc 按键来退出插入模式 。 因为我们几乎总是想要在行尾附加文本，所以 vi 提供了一种快捷方式来移动到当前行的末 尾，并且能添加文本，它是 A 命令。 试着用一下它，给文件添加更多行。首先，使用 &quot;0&quot;(零) 命令，将光标移动到行首；现在我们输入&quot;A&quot;，来添加以下文本行： The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 Line 5 再一次，按下 Esc 按键退出插入模式。 正如我们所看到的，大 A 命令非常有用，因为在启动插入模式之前，它把光标移到了行尾 。 打开一行 我们插入文本的另一种方式是 “打开” 一行；这会在存在的两行之间插入一个空白行，并且进入插入模式，这种方式有两个变体： 命令 打开行 o 当前行的下方打开一行 O 当前行的上方打开一行 我们可以演示一下：把光标放到 &quot;Line 3&quot; 上，按下小 o 按键 The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 line 4 line 5 在第三行之下打开了新的一行，并且进入插入模式。按下 Esc，退出插入模式。 按下 u 按键，撤销我们的修改。 按下大 O 按键在光标之上打开新的一行 。 The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 Line 5 按下 Esc 按键，退出插入模式，并且按下 u 按键，撤销我们的更改。 删除文本 正如我们期望的，vi 提供了各种各样的方式来删除文本，所有的方式包含一个或两个按键。 首先，x 按键会删除光标位置的一个字符，可以在 x 命令之前带上一个数字来指明要删除的字符个数。 d 按键更通用一些。 类似 x 命令，d 命令之前可以带上一个数字，来指定要执行的删除次数；另外，d 命令之后总是带上一个移动命令，用来控制删除的范围 这里有些实例 命令 删除的文本 x 当前字符 3x 当前字符及其后的两个字符 dd 当前行 5dd 当前行及随后的四行文本 dW 从光标位置开始到下一个单词的开头 d$ 从光标位置开始到当前行的行尾 d0 从光标位置开始到当前行的行首 dˆ 从光标位置开始到文本行的第一个非空字符 dG 从当前行到文件的末尾 d20G 从当前行到文件的第 20 行 把光标放到第一行单词 &quot;It&quot; 之上，重复按下 x 按键直到删除剩下的部分。 下一步，重复按下 u 按键直到恢复原貌。 注意：真正的 vi 只是支持单层面的 undo 命令。 vim 则支持多个层面的。 我们再次执行删除命令，这次使用 d 命令。 还是移动光标到单词 &quot;It&quot; 之上，按下 dW 来删除单词 。 The quick brown fox jumped over the lazy dog. was cool. Line 2 Line 3 Line 4 Line 5 按下 d$ 删除从光标位置到行尾的文本。 The quick brown fox jumped over the lazy dog. Line 2 Line 3 Line 4 Line 5 按下 dG 按键删除从当前行到文件末尾的所有行。 ~ .... 连续按下 u 按键三次，来恢复删除部分。 剪切，复制和粘贴文本 这个 d 命令不仅删除文本，它还 &quot;剪切&quot; 文本。 每次我们使用 d 命令，删除的部分被复制到一个粘贴缓冲区中 (看作剪切板)。 稍后我们可以执行小 p 命令把剪切板中的文本粘贴到光标位置之后，或者是大 P 命令把文本粘贴到光标之前。 y 命令用来 &quot;yank&quot;(copy) [– &quot;拉&quot;(复制)] 文本，和 d 命令剪切文本的方式差不多。 这里有些把 y 命令和各种移动命令结合起来使用的实例。 命令 复制的内容 yy 当前行 5yy 当前行及随后的四行文本 yW 从当前光标位置到下一个单词的开头 y$ 从当前光标位置到当前行的末尾 y0 从当前光标位置到行首 yˆ 从当前光标位置到文本行的第一个非空字符 yG 从当前行到文件末尾 y20G 从当前行到文件的第 20 行 我们试着做些复制和粘贴工作。 把光标放到文本第一行，输入 yy 来复制当前行。 下一步，把光标移到最后一行(G)，输入小写的 p 把复制的一行粘贴到当前行的下面。 The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 Line 5 The quick brown fox jumped over the lazy dog. It was cool. 和以前一样，u 命令会撤销我们的修改。 光标仍然位于文件的最后一行，输入大写的 P 命令把所复制的文本粘贴到当前行之上。 The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 The quick brown fox jumped over the lazy dog. It was cool. Line 5 试着执行上表中一些其他的 y 命令，了解小写 p 和大写 P 命令的行为。 当你完成练习之后，把文件恢复原样。 连接行 vi 对于行的概念相当严格，通常，不可能把光标移到行尾，再删除行尾结束符 (回车符) 来连接当前行和它下面的一行。 由于这个原因，vi 提供了一个特定的命令，大写的 J (不要与小写的 j 混淆了, j 是用来移动光标的) 把行与行之间连接起来。 如果我们把光标放到 line 3 上，输入大写的 J 命令，看看发生什么情况。 The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 Line 5 查找和替换 vi 能够把光标移动到搜索到的匹配项上。 vi 可以在单一行或整个文件中运用这个功能。 它也可以在有或没有用户确认的情况下实现文本替换。 查找一行 f 命令查找一行，移动光标到下一个所指定的字符上。 例如，命令 fa 会把光标定位到同一行中下一个出现的 &quot;a&quot; 字符上。 在一行中执行了字符的查找命令之后，通过输入 &quot;;&quot; 分号来重复这个查找。 查找整个文件 移动光标到下一个出现的单词或短语上，使用 / 命令。这个命令和我们之前在 less 程序中学到的一样。 当你输入 / 命令后，一个 &quot;/&quot; 字符会出现在屏幕底部。 下一步，输入要查找的单词或短语后，按下回车，光标就会移动到下一个包含所查找字符串的位置。 通过 n 命令来重复先前的查找。 这里有个例子： The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 Line 5 把光标移动到文件的第一行。 输入 /Line 然后键入回车。 光标会移动到第二行。 下一步，输入 n, 光标移到第三行 重复这个 n 命令，光标会继续向下移动直到遍历了所有的匹配项。 虽然目前我们只是使用了单词和短语来作为我们的查找模式，但是 vi 允许使用正则表达式，一种强大的用来表示复杂文本模式的方法。 我们将会在随后的章节里面详尽地介绍正则表达式。 全局查找和替代 vi 使用 ex 命令来执行查找和 替换(replace) 操作 (vi 中叫做 “substitution” [– 中文也是代替, 替换的意思])。 把整个文件中的单词“Line”，更改为“line”。 我们输入以下命令： :%s/Line/line/g 我们把这个命令分解为几个单独的部分，看一下每部分的含义： 条目 含义 : 冒号字符运行一个 ex 命令 % 指定要操作的行数 % 是一个快捷方式, 表示从第一行到最后一行另外, 操作范围也可以用数字代替例如 1,5 (因为我们的文件只有 5 行文本)或者用 1,$ 来代替, 意思是 &quot;从第一行到文件的最后一行&quot; 如果省略了文本行的范围, 那么操作只对当前行生效 s 指定操作在这种情况下是, 替换 (查找与替代) /Line/line 查找类型与替代文本 g 这是 &quot;全局&quot; 的意思意味着对文本行中所有匹配的字符串执行查找和替换操作如果省略 g, 则只替换每个文本行中第一个匹配的字符串 执行完查找和替代命令之后，我们的文件看起来像这样： The quick brown fox jumped over the lazy dog. It was cool. line 2 line 3 line 4 line 5 我们也可以指定一个需要用户确认的替换命令，通过添加一个 &quot;c&quot; 字符到这个命令的末尾来完成这个替换命令。 例如： :%s/line/Line/gc 这个命令会把我们的文件恢复先前的模样。然而，在执行每个替换命令之前，vi 会停下来，通过下面的信息，来要求我们确认这个替换。 replace with Line (y/n/a/q/l/^E/^Y)? 括号中的每个字符都是一个可能的选择，如下所示。 按键 行为 y 执行替换操作 n 跳过这个匹配的实例 a 对这个及随后所有匹配的字符串执行替换操作 q 或者 esc 退出替换操作 l 执行这次替换并退出l 是 &quot;last&quot; 的简写 Ctrl-e, Ctrl-y 分别是向下滚动和向上滚动用于查看建议替换的上下文 如果你输入 y，则执行这个替换，输入 n 则会导致 vi 跳过这个实例，而移到下一个匹配项上。 编辑多个文件 同时能够编辑多个文件是很有用的，你可能需要更改多个文件或者从一个文件复制内容到另一个文件。 通过 vi，我们可以打开多个文件来编辑，只要在命令行中指定要编辑的文件名 vi file1 file2 file3... 我们先退出已经存在的 vi 会话，然后创建一个新文件来编辑。 输入 :wq 来退出 vi 并且保存所做的修改。 下一步，我们将在 home(家) 目录下创建一个额外用来玩耍的文件，通过获取从 ls 命令的输出，来创建这个文件 ls -l /usr/bin &gt; ls-output.txt 用 vi 来编辑我们的原文件和新创建的文件。 vi foo.txt ls-output.txt vi 启动，我们会看到第一个文件显示出来。 The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 Line 5 文件之间转换 从这个文件转到下一个文件，使用这个 ex 命令： :n 回到先前的文件使用： :N 当我们从一个文件移到另一个文件时，如果当前文件没有保存修改，vi 会阻止我们转换文件，这是 vi 强制执行的政策。 在命令之后添加感叹号，可以强迫 vi 放弃修改而转换文件。 另外，上面所描述的转换方法，vim (和一些版本的 vi) 也提供了一些 ex 命令，这些命令使多个文件更容易管理。 我们可以使用 :buffers 命令查看正在编辑的文件列表。 运行这个命令后，屏幕顶部就会显示出一个文件列表。 :buffers 1 %a &quot;foo.txt&quot; line 1 2 &quot;ls-output.txt&quot; line 0 Press ENTER or type command to continue 转换到其它缓冲区(文件), 输入 :buffers 缓冲区数字。 例如，从包含 foot.txt 文件的缓冲区1，转换到包含 ls-output.txt 文件的缓冲区2，应该输入 :buffer 2 我们的屏幕上将会显示的是第二个文件。 打开编辑额外的文件 当我们正在编辑文件时，同样可以打开其它文件加入进来。 ex 的 :e 命令(&quot;edit&quot; 的缩写)后面跟着一个想要打开的额外文件名。 我们先退出目前的编辑模式，返回到命令行，使用 vi 只打开一个文件： vi foo.txt 添加第二个文件，输入命令： :e ls-output.txt 它会显示在屏幕上，并且，通过验证，第一个文件仍然存在。 :buffers 1 # &quot;foo.txt&quot; line 1 2 %a &quot;ls-output.txt&quot; line 0 Press ENTER or type command to continue 注意：你不能通过 :n 或 :N 命令在由 :e 命令加载的文件之间进行切换。 这时要使用 :buffer 命令，其后加上缓冲区号码，来转换文件。 从一个文件复制内容到另一个文件 当我们编辑多个文件时，经常地要复制文件的一部分到另一个正在编辑的文件。 使用之前我们学到的拉 (yank) 和粘贴命令，这很容易完成。 以打开的两个文件为例，首先转换到缓冲区 1 (foo.txt)， 输入： :buffer 1 我们应该得到以下输出： The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 Line 5 下一步, 把光标移到第一行，并且输入 yy 来复制这一行。 转换到第二个缓冲区, 输入： :buffer 2 现在屏幕会包含一些文件列表 (这里只列出了一部分)： total 343700 -rwxr-xr-x 1 root root 31316 2007-12-05 08:58 [ -rwxr-xr-x 1 root root 8240 2015-12-09 13:39 411toppm -rwxr-xr-x 1 root root 111276 2016-01-31 13:36 a2p -rwxr-xr-x 1 root root 25368 2014-10-06 20:16 a52dec -rwxr-xr-x 1 root root 11532 2015-05-04 17:43 aafire -rwxr-xr-x 1 root root 7292 2015-05-04 17:43 aainfo 移动光标到第一行，输入 p 命令把我们从前面文件中复制的一行粘贴到这个文件中： total 343700 The quick brown fox jumped over the lazy dog. It was cool. -rwxr-xr-x 1 root root 31316 2015-12-05 08:58 [ -rwxr-xr-x 1 root root 8240 2015-12-09 13:39 411toppm -rwxr-xr-x 1 root root 111276 2016-01-31 13:36 a2p -rwxr-xr-x 1 root root 25368 2014-10-06 20:16 a52dec -rwxr-xr-x 1 root root 11532 2015-05-04 17:43 aafire -rwxr-xr-x 1 root root 7292 2015-05-04 17:43 aainfo 插入整个文件到另一个文件 也有可能把整个文件插入到我们所编辑的文件中。 看一下实际操作，结束 vi 会话，重新启动一个只打开一个文件的 vi 会话。 vi ls-output.txt 再一次看到我们的文件列表： total 343700 -rwxr-xr-x 1 root root 31316 2015-12-05 08:58 [ -rwxr-xr-x 1 root root 8240 2015-12-09 13:39 411toppm -rwxr-xr-x 1 root root 111276 2016-01-31 13:36 a2p -rwxr-xr-x 1 root root 25368 2014-10-06 20:16 a52dec -rwxr-xr-x 1 root root 11532 2015-05-04 17:43 aafire -rwxr-xr-x 1 root root 7292 2015-05-04 17:43 aainfo 移动光标到第三行，然后输入以下 ex 命令： :r foo.txt 这个 :r 命令 (是 &quot;read&quot; 的简称) 把指定的文件插入到光标位置之前。 现在屏幕应该看起来像这样： total 343700 -rwxr-xr-x 1 root root 31316 2015-12-05 08:58 [ -rwxr-xr-x 1 root root 8240 2015-12-09 13:39 411toppm The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 Line 5 -rwxr-xr-x 1 root root 111276 2016-01-31 13:36 a2p -rwxr-xr-x 1 root root 25368 2014-10-06 20:16 a52dec -rwxr-xr-x 1 root root 11532 2015-05-04 17:43 aafire -rwxr-xr-x 1 root root 7292 2015-05-04 17:43 aainfo 保存工作 像 vi 中的其它操作一样，有几种不同的方法来保存我们所修改的文件。 我们已经研究了 :w 这个 ex 命令, 但还有几种方法，可能我们也觉得有帮助，在命令模式下，输入 ZZ 就会保存并退出当前文件。 同样地, ex 命令 :wq 把 :w 和 :q 命令结合到一起来完成保存和退出任务。 这个 :w 命令也可以指定可选的文件名。 这个的作用就如 &quot;另存为&quot;。 例如，如果我们正在编辑 foo.txt 文件，想要保存一个副本，叫做 foo1.txt，那么我们可以执行以下命令 :w foo1.txt 注意：当上面的命令以一个新名字保存文件时，但它并没有更改你正在编辑的文件的名字，如果你继续编辑的话，你还是在编辑文件 foo.txt，而不是 foo1.txt。 拓展阅读 即使把这章所学的内容都加起来，我们也只是学了 vi 和 vim 的一点儿皮毛而已。 这里有一些在线的资料，你可以用来继续 vi 学习之旅。 学习 vi 编辑器－一本来自于 Wikipedia 的 Wikibook, 是一本关于 vi 的简要指南, 并介绍了几个类似 vi 的程序, 其中包括 vim。 它可以在下面链接中得到: http://en.wikibooks.org/wiki/Vi The Vim Book － vim 项目, 一本 570 页的书籍, 包含了(几乎)所有的 vim 特性。 你能在下面链接中找到它: ftp://ftp.vim.org/pub/vim/doc/book/vimbook-OPL.pdf Wikipedia 上关于 vi 的创始人 Bill Joy 的文章: http://en.wikipedia.org/wiki/Bill_Joy Wikipedia 上关于 vim 的作者 Bram Moolenaar 的文章: http://en.wikipedia.org/wiki/Bram_Moolenaar 参考: happypeter/TLCL The Linux Command Line"/> <meta property="og:description" content="为什么我们应该学习 vi 背景介绍 启动和停止 vi 创建新文件 插入模式 保存我们的工作 移动光标 基本编辑 追加文本 打开一行 删除文本 剪切，复制和粘贴文本 连接行 查找和替换 查找一行 查找整个文件 全局查找和替代 编辑多个文件 文件之间转换 打开编辑额外的文件 从一个文件复制内容到另一个文件 插入整个文件到另一个文件 保存工作 拓展阅读 为什么我们应该学习 vi 在现在这个图形编辑器和易于使用的基于文本编辑器的时代，比如说 nano，为什么我们还 应该学习 vi 呢？下面有三个充分的理由： vi 很多系统都预装。 如果我们的系统没有图形界面，比方说一台远端服务器或者是一个 X 配置损坏了的本地系统，那么 vi 就成了我们的救星。 虽然 nano 逐渐流行起来，但是它还没有普及。 POSIX，这套 Unix 系统中程序兼容的标准，就要求系统要预装 vi。 vi 是轻量级且执行快速的编辑器。 对于许多任务来说，启动 vi 比起在菜单中找到一个图形化文本编辑器，再等待编辑器数倍兆字节的数据加载而言，要容易的多。 另外，vi 是为了加快输入速度而设计的。 我们将会看到，当一名熟练的 vi 用户在编辑文件时，他或她的手从不需要移开键盘。 我们不希望其他 Linux 和 Unix 用户把我们看作胆小鬼 好吧，可能只有两个充分的理由。 背景介绍 第一版 vi 是在 1976 由 Bill Joy 写成的，当时他是加州大学伯克利分校的学生，后来他共同创建了 Sun 微系统公司。 vi 这个名字来源于单词 &quot;visual&quot;，因为它打算在带有可移动光标的视频终端上编辑文本。 在发明可视化编辑器之前，有一次只能操作一行文本的行编辑器。为了指定一个修改，我们告诉行编辑器到一个特殊行并且说明做什么修改，比方说添加或删除文本。 视频终端 (而不是基于打印机的终端，像电传打印机) 的出现，可视化编辑成为可能。 vi 实际上整合了一个强大的叫做 ex 行编辑器，所以我们在使用 vi 时能运行行编辑命令。 启动和停止 vi 启动 vi: vi 停止 vi: :q 强制退出: q! 注意：冒号是命令的一部分 小贴士：如果你在 vi 中 &quot;迷失&quot; 了，试着按下 Esc 键两次来找到路(回到普通模式)。 创建新文件 启动 vi 时, 传递给 vi 一个不存在的文件名，就创建了一个新文件： vi foo.txt 每行开头的波浪号 (&quot;~&quot;) 指示那一行不存在文本，这表示我们有一个空文件，还没有输入 任何字符。 小贴士：vi 是一个模式编辑器。 当 vi 启动后，进入的是命令模式；这种模式下，几乎每个按键都是一个命令，所以如果 我们打算输入字符，vi 会发疯，弄得一团糟。 插入模式 为了在文件中添加文本，首先我们必须进入插入模式。 按下 &quot;i&quot; 按键进入插入模式，现在我们能输入一些文本了，试着输入这些文本： The quick brown fox jumped over the lazy dog. 按下 Esc 按键, 退出插入模式并返回命令模式。 保存我们的工作 为了保存我们刚才对文件所做的修改，我们必须在命令模式下输入一个 ex 命令，通过按下 &quot;:&quot; 键，这很容易完成。 按下冒号键之后，一个冒号字符应该出现在屏幕的底部： : 为了写入我们修改的文件，我们在冒号之后输入 &quot;w&quot; 字符，然后按下回车键: :w 文件将会写入到硬盘，并且我们应该在屏幕底部得到一个确认信息，就像这样： &quot;foo.txt&quot; [New] 1L, 46C written 小贴示：如果你阅读 vim 的文档，你注意到 (混淆地) 命令模式被叫做普通模式，ex 命令叫做命令模式，当心。 移动光标 当在 vi 命令模式下时，vi 提供了大量的移动命令，其中一些是与 less 阅读器共享的。这里列举了一些： 按键 移动光标 l 或 右箭头 向右移动一个字符 h 或 左箭头 向左移动一个字符 j 或 下箭头 向下移动一行 k 或 上箭头 向上移动一行 0 (零按键) 移动到当前行的行首 ˆ 移动到当前行的第一个非空字符 $ 移动到当前行的末尾 w 移动到下一个单词或标点符号的开头 W 移动到下一个单词的开头, 忽略标点符号 b 移动到上一个单词或标点符号的开头 B 移动到上一个单词的开头, 忽略标点符号 Ctrl-f 或 Page Down 向下翻一页 Ctrl-b 或 Page Up 向上翻一页 numberG 移动到第 number 行. 例如: 1G 移动到文件的第一行 g 移动到文件的开端 G 移动到文件末尾 为什么 h、j、k 和 l 按键被用来移动光标呢？ 因为在开发 vi 之初，并不是所有的视频终端都有箭头按键，熟练的打字员可以使用规则的键盘按键来移动光标，他们的手从不需要移开键盘。 vi 中的许多命令都可以在前面加上一个数字，比方说上面提到的 &quot;G&quot; 命令，在命令之前加上一个数字，我们就可以指定命令执行的次数。 例如，命令 &quot;5j&quot; 导致 vi 向下移动 5 行。 基本编辑 大多数编辑工作由一些基本的操作组成，比如说插入文本，删除文本和通过剪切和粘贴来移动文本。 vi，当然以它自己的独特方式来支持所有的操作。 vi 也提供了有限的撤销形式；如果我们按下 &quot;u&quot; 按键，当在命令模式下，vi 将会撤销你所做的最后一次修改，当我们试着执行一些基本的编辑命令时，这会很方便。 追加文本 vi 有几种不同进入插入模式的方法。我们已经使用了 i 命令来插入文本，让我们返回到我们的 foo.txt 文件中, 呆一会儿。 The quick brown fox jumped over the lazy dog 如果我们想要在这个句子的末尾添加一些文本，我们会发现 i 命令不能完成任务，因为我们 不能把光标移到行尾。 vi 提供了追加文本的命令，明智地命名为 a 命令，如果我们把光标移动到行尾，输入 a 光标就会越过行尾，vi 进入插入模式。这样就允许我们添加更多的文本。 The quick brown fox jumped over the lazy dog. It was cool. 记住按下 Esc 按键来退出插入模式 。 因为我们几乎总是想要在行尾附加文本，所以 vi 提供了一种快捷方式来移动到当前行的末 尾，并且能添加文本，它是 A 命令。 试着用一下它，给文件添加更多行。首先，使用 &quot;0&quot;(零) 命令，将光标移动到行首；现在我们输入&quot;A&quot;，来添加以下文本行： The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 Line 5 再一次，按下 Esc 按键退出插入模式。 正如我们所看到的，大 A 命令非常有用，因为在启动插入模式之前，它把光标移到了行尾 。 打开一行 我们插入文本的另一种方式是 “打开” 一行；这会在存在的两行之间插入一个空白行，并且进入插入模式，这种方式有两个变体： 命令 打开行 o 当前行的下方打开一行 O 当前行的上方打开一行 我们可以演示一下：把光标放到 &quot;Line 3&quot; 上，按下小 o 按键 The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 line 4 line 5 在第三行之下打开了新的一行，并且进入插入模式。按下 Esc，退出插入模式。 按下 u 按键，撤销我们的修改。 按下大 O 按键在光标之上打开新的一行 。 The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 Line 5 按下 Esc 按键，退出插入模式，并且按下 u 按键，撤销我们的更改。 删除文本 正如我们期望的，vi 提供了各种各样的方式来删除文本，所有的方式包含一个或两个按键。 首先，x 按键会删除光标位置的一个字符，可以在 x 命令之前带上一个数字来指明要删除的字符个数。 d 按键更通用一些。 类似 x 命令，d 命令之前可以带上一个数字，来指定要执行的删除次数；另外，d 命令之后总是带上一个移动命令，用来控制删除的范围 这里有些实例 命令 删除的文本 x 当前字符 3x 当前字符及其后的两个字符 dd 当前行 5dd 当前行及随后的四行文本 dW 从光标位置开始到下一个单词的开头 d$ 从光标位置开始到当前行的行尾 d0 从光标位置开始到当前行的行首 dˆ 从光标位置开始到文本行的第一个非空字符 dG 从当前行到文件的末尾 d20G 从当前行到文件的第 20 行 把光标放到第一行单词 &quot;It&quot; 之上，重复按下 x 按键直到删除剩下的部分。 下一步，重复按下 u 按键直到恢复原貌。 注意：真正的 vi 只是支持单层面的 undo 命令。 vim 则支持多个层面的。 我们再次执行删除命令，这次使用 d 命令。 还是移动光标到单词 &quot;It&quot; 之上，按下 dW 来删除单词 。 The quick brown fox jumped over the lazy dog. was cool. Line 2 Line 3 Line 4 Line 5 按下 d$ 删除从光标位置到行尾的文本。 The quick brown fox jumped over the lazy dog. Line 2 Line 3 Line 4 Line 5 按下 dG 按键删除从当前行到文件末尾的所有行。 ~ .... 连续按下 u 按键三次，来恢复删除部分。 剪切，复制和粘贴文本 这个 d 命令不仅删除文本，它还 &quot;剪切&quot; 文本。 每次我们使用 d 命令，删除的部分被复制到一个粘贴缓冲区中 (看作剪切板)。 稍后我们可以执行小 p 命令把剪切板中的文本粘贴到光标位置之后，或者是大 P 命令把文本粘贴到光标之前。 y 命令用来 &quot;yank&quot;(copy) [– &quot;拉&quot;(复制)] 文本，和 d 命令剪切文本的方式差不多。 这里有些把 y 命令和各种移动命令结合起来使用的实例。 命令 复制的内容 yy 当前行 5yy 当前行及随后的四行文本 yW 从当前光标位置到下一个单词的开头 y$ 从当前光标位置到当前行的末尾 y0 从当前光标位置到行首 yˆ 从当前光标位置到文本行的第一个非空字符 yG 从当前行到文件末尾 y20G 从当前行到文件的第 20 行 我们试着做些复制和粘贴工作。 把光标放到文本第一行，输入 yy 来复制当前行。 下一步，把光标移到最后一行(G)，输入小写的 p 把复制的一行粘贴到当前行的下面。 The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 Line 5 The quick brown fox jumped over the lazy dog. It was cool. 和以前一样，u 命令会撤销我们的修改。 光标仍然位于文件的最后一行，输入大写的 P 命令把所复制的文本粘贴到当前行之上。 The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 The quick brown fox jumped over the lazy dog. It was cool. Line 5 试着执行上表中一些其他的 y 命令，了解小写 p 和大写 P 命令的行为。 当你完成练习之后，把文件恢复原样。 连接行 vi 对于行的概念相当严格，通常，不可能把光标移到行尾，再删除行尾结束符 (回车符) 来连接当前行和它下面的一行。 由于这个原因，vi 提供了一个特定的命令，大写的 J (不要与小写的 j 混淆了, j 是用来移动光标的) 把行与行之间连接起来。 如果我们把光标放到 line 3 上，输入大写的 J 命令，看看发生什么情况。 The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 Line 5 查找和替换 vi 能够把光标移动到搜索到的匹配项上。 vi 可以在单一行或整个文件中运用这个功能。 它也可以在有或没有用户确认的情况下实现文本替换。 查找一行 f 命令查找一行，移动光标到下一个所指定的字符上。 例如，命令 fa 会把光标定位到同一行中下一个出现的 &quot;a&quot; 字符上。 在一行中执行了字符的查找命令之后，通过输入 &quot;;&quot; 分号来重复这个查找。 查找整个文件 移动光标到下一个出现的单词或短语上，使用 / 命令。这个命令和我们之前在 less 程序中学到的一样。 当你输入 / 命令后，一个 &quot;/&quot; 字符会出现在屏幕底部。 下一步，输入要查找的单词或短语后，按下回车，光标就会移动到下一个包含所查找字符串的位置。 通过 n 命令来重复先前的查找。 这里有个例子： The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 Line 5 把光标移动到文件的第一行。 输入 /Line 然后键入回车。 光标会移动到第二行。 下一步，输入 n, 光标移到第三行 重复这个 n 命令，光标会继续向下移动直到遍历了所有的匹配项。 虽然目前我们只是使用了单词和短语来作为我们的查找模式，但是 vi 允许使用正则表达式，一种强大的用来表示复杂文本模式的方法。 我们将会在随后的章节里面详尽地介绍正则表达式。 全局查找和替代 vi 使用 ex 命令来执行查找和 替换(replace) 操作 (vi 中叫做 “substitution” [– 中文也是代替, 替换的意思])。 把整个文件中的单词“Line”，更改为“line”。 我们输入以下命令： :%s/Line/line/g 我们把这个命令分解为几个单独的部分，看一下每部分的含义： 条目 含义 : 冒号字符运行一个 ex 命令 % 指定要操作的行数 % 是一个快捷方式, 表示从第一行到最后一行另外, 操作范围也可以用数字代替例如 1,5 (因为我们的文件只有 5 行文本)或者用 1,$ 来代替, 意思是 &quot;从第一行到文件的最后一行&quot; 如果省略了文本行的范围, 那么操作只对当前行生效 s 指定操作在这种情况下是, 替换 (查找与替代) /Line/line 查找类型与替代文本 g 这是 &quot;全局&quot; 的意思意味着对文本行中所有匹配的字符串执行查找和替换操作如果省略 g, 则只替换每个文本行中第一个匹配的字符串 执行完查找和替代命令之后，我们的文件看起来像这样： The quick brown fox jumped over the lazy dog. It was cool. line 2 line 3 line 4 line 5 我们也可以指定一个需要用户确认的替换命令，通过添加一个 &quot;c&quot; 字符到这个命令的末尾来完成这个替换命令。 例如： :%s/line/Line/gc 这个命令会把我们的文件恢复先前的模样。然而，在执行每个替换命令之前，vi 会停下来，通过下面的信息，来要求我们确认这个替换。 replace with Line (y/n/a/q/l/^E/^Y)? 括号中的每个字符都是一个可能的选择，如下所示。 按键 行为 y 执行替换操作 n 跳过这个匹配的实例 a 对这个及随后所有匹配的字符串执行替换操作 q 或者 esc 退出替换操作 l 执行这次替换并退出l 是 &quot;last&quot; 的简写 Ctrl-e, Ctrl-y 分别是向下滚动和向上滚动用于查看建议替换的上下文 如果你输入 y，则执行这个替换，输入 n 则会导致 vi 跳过这个实例，而移到下一个匹配项上。 编辑多个文件 同时能够编辑多个文件是很有用的，你可能需要更改多个文件或者从一个文件复制内容到另一个文件。 通过 vi，我们可以打开多个文件来编辑，只要在命令行中指定要编辑的文件名 vi file1 file2 file3... 我们先退出已经存在的 vi 会话，然后创建一个新文件来编辑。 输入 :wq 来退出 vi 并且保存所做的修改。 下一步，我们将在 home(家) 目录下创建一个额外用来玩耍的文件，通过获取从 ls 命令的输出，来创建这个文件 ls -l /usr/bin &gt; ls-output.txt 用 vi 来编辑我们的原文件和新创建的文件。 vi foo.txt ls-output.txt vi 启动，我们会看到第一个文件显示出来。 The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 Line 5 文件之间转换 从这个文件转到下一个文件，使用这个 ex 命令： :n 回到先前的文件使用： :N 当我们从一个文件移到另一个文件时，如果当前文件没有保存修改，vi 会阻止我们转换文件，这是 vi 强制执行的政策。 在命令之后添加感叹号，可以强迫 vi 放弃修改而转换文件。 另外，上面所描述的转换方法，vim (和一些版本的 vi) 也提供了一些 ex 命令，这些命令使多个文件更容易管理。 我们可以使用 :buffers 命令查看正在编辑的文件列表。 运行这个命令后，屏幕顶部就会显示出一个文件列表。 :buffers 1 %a &quot;foo.txt&quot; line 1 2 &quot;ls-output.txt&quot; line 0 Press ENTER or type command to continue 转换到其它缓冲区(文件), 输入 :buffers 缓冲区数字。 例如，从包含 foot.txt 文件的缓冲区1，转换到包含 ls-output.txt 文件的缓冲区2，应该输入 :buffer 2 我们的屏幕上将会显示的是第二个文件。 打开编辑额外的文件 当我们正在编辑文件时，同样可以打开其它文件加入进来。 ex 的 :e 命令(&quot;edit&quot; 的缩写)后面跟着一个想要打开的额外文件名。 我们先退出目前的编辑模式，返回到命令行，使用 vi 只打开一个文件： vi foo.txt 添加第二个文件，输入命令： :e ls-output.txt 它会显示在屏幕上，并且，通过验证，第一个文件仍然存在。 :buffers 1 # &quot;foo.txt&quot; line 1 2 %a &quot;ls-output.txt&quot; line 0 Press ENTER or type command to continue 注意：你不能通过 :n 或 :N 命令在由 :e 命令加载的文件之间进行切换。 这时要使用 :buffer 命令，其后加上缓冲区号码，来转换文件。 从一个文件复制内容到另一个文件 当我们编辑多个文件时，经常地要复制文件的一部分到另一个正在编辑的文件。 使用之前我们学到的拉 (yank) 和粘贴命令，这很容易完成。 以打开的两个文件为例，首先转换到缓冲区 1 (foo.txt)， 输入： :buffer 1 我们应该得到以下输出： The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 Line 5 下一步, 把光标移到第一行，并且输入 yy 来复制这一行。 转换到第二个缓冲区, 输入： :buffer 2 现在屏幕会包含一些文件列表 (这里只列出了一部分)： total 343700 -rwxr-xr-x 1 root root 31316 2007-12-05 08:58 [ -rwxr-xr-x 1 root root 8240 2015-12-09 13:39 411toppm -rwxr-xr-x 1 root root 111276 2016-01-31 13:36 a2p -rwxr-xr-x 1 root root 25368 2014-10-06 20:16 a52dec -rwxr-xr-x 1 root root 11532 2015-05-04 17:43 aafire -rwxr-xr-x 1 root root 7292 2015-05-04 17:43 aainfo 移动光标到第一行，输入 p 命令把我们从前面文件中复制的一行粘贴到这个文件中： total 343700 The quick brown fox jumped over the lazy dog. It was cool. -rwxr-xr-x 1 root root 31316 2015-12-05 08:58 [ -rwxr-xr-x 1 root root 8240 2015-12-09 13:39 411toppm -rwxr-xr-x 1 root root 111276 2016-01-31 13:36 a2p -rwxr-xr-x 1 root root 25368 2014-10-06 20:16 a52dec -rwxr-xr-x 1 root root 11532 2015-05-04 17:43 aafire -rwxr-xr-x 1 root root 7292 2015-05-04 17:43 aainfo 插入整个文件到另一个文件 也有可能把整个文件插入到我们所编辑的文件中。 看一下实际操作，结束 vi 会话，重新启动一个只打开一个文件的 vi 会话。 vi ls-output.txt 再一次看到我们的文件列表： total 343700 -rwxr-xr-x 1 root root 31316 2015-12-05 08:58 [ -rwxr-xr-x 1 root root 8240 2015-12-09 13:39 411toppm -rwxr-xr-x 1 root root 111276 2016-01-31 13:36 a2p -rwxr-xr-x 1 root root 25368 2014-10-06 20:16 a52dec -rwxr-xr-x 1 root root 11532 2015-05-04 17:43 aafire -rwxr-xr-x 1 root root 7292 2015-05-04 17:43 aainfo 移动光标到第三行，然后输入以下 ex 命令： :r foo.txt 这个 :r 命令 (是 &quot;read&quot; 的简称) 把指定的文件插入到光标位置之前。 现在屏幕应该看起来像这样： total 343700 -rwxr-xr-x 1 root root 31316 2015-12-05 08:58 [ -rwxr-xr-x 1 root root 8240 2015-12-09 13:39 411toppm The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 Line 5 -rwxr-xr-x 1 root root 111276 2016-01-31 13:36 a2p -rwxr-xr-x 1 root root 25368 2014-10-06 20:16 a52dec -rwxr-xr-x 1 root root 11532 2015-05-04 17:43 aafire -rwxr-xr-x 1 root root 7292 2015-05-04 17:43 aainfo 保存工作 像 vi 中的其它操作一样，有几种不同的方法来保存我们所修改的文件。 我们已经研究了 :w 这个 ex 命令, 但还有几种方法，可能我们也觉得有帮助，在命令模式下，输入 ZZ 就会保存并退出当前文件。 同样地, ex 命令 :wq 把 :w 和 :q 命令结合到一起来完成保存和退出任务。 这个 :w 命令也可以指定可选的文件名。 这个的作用就如 &quot;另存为&quot;。 例如，如果我们正在编辑 foo.txt 文件，想要保存一个副本，叫做 foo1.txt，那么我们可以执行以下命令 :w foo1.txt 注意：当上面的命令以一个新名字保存文件时，但它并没有更改你正在编辑的文件的名字，如果你继续编辑的话，你还是在编辑文件 foo.txt，而不是 foo1.txt。 拓展阅读 即使把这章所学的内容都加起来，我们也只是学了 vi 和 vim 的一点儿皮毛而已。 这里有一些在线的资料，你可以用来继续 vi 学习之旅。 学习 vi 编辑器－一本来自于 Wikipedia 的 Wikibook, 是一本关于 vi 的简要指南, 并介绍了几个类似 vi 的程序, 其中包括 vim。 它可以在下面链接中得到: http://en.wikibooks.org/wiki/Vi The Vim Book － vim 项目, 一本 570 页的书籍, 包含了(几乎)所有的 vim 特性。 你能在下面链接中找到它: ftp://ftp.vim.org/pub/vim/doc/book/vimbook-OPL.pdf Wikipedia 上关于 vi 的创始人 Bill Joy 的文章: http://en.wikipedia.org/wiki/Bill_Joy Wikipedia 上关于 vim 的作者 Bram Moolenaar 的文章: http://en.wikipedia.org/wiki/Bram_Moolenaar 参考: happypeter/TLCL The Linux Command Line"/> <link rel="canonical" href="https://empvalley.com/2018/03/09/vi-commands/"/> <meta property="og:url" content="https://empvalley.com/2018/03/09/vi-commands/"/> <meta property="og:site_name" content="晨霜’s Blog"/> <meta property="og:type" content="article"/> <meta property="article:published_time" content="2018-03-09T00:00:00+08:00"/> <meta name="twitter:card" content="summary"/> <meta property="twitter:title" content="vi 常用命令"/> <script type="application/ld+json">
{"url":"https://empvalley.com/2018/03/09/vi-commands/","author":{"@type":"Person","name":"晨霜"},"description":"为什么我们应该学习 vi 背景介绍 启动和停止 vi 创建新文件 插入模式 保存我们的工作 移动光标 基本编辑 追加文本 打开一行 删除文本 剪切，复制和粘贴文本 连接行 查找和替换 查找一行 查找整个文件 全局查找和替代 编辑多个文件 文件之间转换 打开编辑额外的文件 从一个文件复制内容到另一个文件 插入整个文件到另一个文件 保存工作 拓展阅读 为什么我们应该学习 vi 在现在这个图形编辑器和易于使用的基于文本编辑器的时代，比如说 nano，为什么我们还 应该学习 vi 呢？下面有三个充分的理由： vi 很多系统都预装。 如果我们的系统没有图形界面，比方说一台远端服务器或者是一个 X 配置损坏了的本地系统，那么 vi 就成了我们的救星。 虽然 nano 逐渐流行起来，但是它还没有普及。 POSIX，这套 Unix 系统中程序兼容的标准，就要求系统要预装 vi。 vi 是轻量级且执行快速的编辑器。 对于许多任务来说，启动 vi 比起在菜单中找到一个图形化文本编辑器，再等待编辑器数倍兆字节的数据加载而言，要容易的多。 另外，vi 是为了加快输入速度而设计的。 我们将会看到，当一名熟练的 vi 用户在编辑文件时，他或她的手从不需要移开键盘。 我们不希望其他 Linux 和 Unix 用户把我们看作胆小鬼 好吧，可能只有两个充分的理由。 背景介绍 第一版 vi 是在 1976 由 Bill Joy 写成的，当时他是加州大学伯克利分校的学生，后来他共同创建了 Sun 微系统公司。 vi 这个名字来源于单词 &quot;visual&quot;，因为它打算在带有可移动光标的视频终端上编辑文本。 在发明可视化编辑器之前，有一次只能操作一行文本的行编辑器。为了指定一个修改，我们告诉行编辑器到一个特殊行并且说明做什么修改，比方说添加或删除文本。 视频终端 (而不是基于打印机的终端，像电传打印机) 的出现，可视化编辑成为可能。 vi 实际上整合了一个强大的叫做 ex 行编辑器，所以我们在使用 vi 时能运行行编辑命令。 启动和停止 vi 启动 vi: vi 停止 vi: :q 强制退出: q! 注意：冒号是命令的一部分 小贴士：如果你在 vi 中 &quot;迷失&quot; 了，试着按下 Esc 键两次来找到路(回到普通模式)。 创建新文件 启动 vi 时, 传递给 vi 一个不存在的文件名，就创建了一个新文件： vi foo.txt 每行开头的波浪号 (&quot;~&quot;) 指示那一行不存在文本，这表示我们有一个空文件，还没有输入 任何字符。 小贴士：vi 是一个模式编辑器。 当 vi 启动后，进入的是命令模式；这种模式下，几乎每个按键都是一个命令，所以如果 我们打算输入字符，vi 会发疯，弄得一团糟。 插入模式 为了在文件中添加文本，首先我们必须进入插入模式。 按下 &quot;i&quot; 按键进入插入模式，现在我们能输入一些文本了，试着输入这些文本： The quick brown fox jumped over the lazy dog. 按下 Esc 按键, 退出插入模式并返回命令模式。 保存我们的工作 为了保存我们刚才对文件所做的修改，我们必须在命令模式下输入一个 ex 命令，通过按下 &quot;:&quot; 键，这很容易完成。 按下冒号键之后，一个冒号字符应该出现在屏幕的底部： : 为了写入我们修改的文件，我们在冒号之后输入 &quot;w&quot; 字符，然后按下回车键: :w 文件将会写入到硬盘，并且我们应该在屏幕底部得到一个确认信息，就像这样： &quot;foo.txt&quot; [New] 1L, 46C written 小贴示：如果你阅读 vim 的文档，你注意到 (混淆地) 命令模式被叫做普通模式，ex 命令叫做命令模式，当心。 移动光标 当在 vi 命令模式下时，vi 提供了大量的移动命令，其中一些是与 less 阅读器共享的。这里列举了一些： 按键 移动光标 l 或 右箭头 向右移动一个字符 h 或 左箭头 向左移动一个字符 j 或 下箭头 向下移动一行 k 或 上箭头 向上移动一行 0 (零按键) 移动到当前行的行首 ˆ 移动到当前行的第一个非空字符 $ 移动到当前行的末尾 w 移动到下一个单词或标点符号的开头 W 移动到下一个单词的开头, 忽略标点符号 b 移动到上一个单词或标点符号的开头 B 移动到上一个单词的开头, 忽略标点符号 Ctrl-f 或 Page Down 向下翻一页 Ctrl-b 或 Page Up 向上翻一页 numberG 移动到第 number 行. 例如: 1G 移动到文件的第一行 g 移动到文件的开端 G 移动到文件末尾 为什么 h、j、k 和 l 按键被用来移动光标呢？ 因为在开发 vi 之初，并不是所有的视频终端都有箭头按键，熟练的打字员可以使用规则的键盘按键来移动光标，他们的手从不需要移开键盘。 vi 中的许多命令都可以在前面加上一个数字，比方说上面提到的 &quot;G&quot; 命令，在命令之前加上一个数字，我们就可以指定命令执行的次数。 例如，命令 &quot;5j&quot; 导致 vi 向下移动 5 行。 基本编辑 大多数编辑工作由一些基本的操作组成，比如说插入文本，删除文本和通过剪切和粘贴来移动文本。 vi，当然以它自己的独特方式来支持所有的操作。 vi 也提供了有限的撤销形式；如果我们按下 &quot;u&quot; 按键，当在命令模式下，vi 将会撤销你所做的最后一次修改，当我们试着执行一些基本的编辑命令时，这会很方便。 追加文本 vi 有几种不同进入插入模式的方法。我们已经使用了 i 命令来插入文本，让我们返回到我们的 foo.txt 文件中, 呆一会儿。 The quick brown fox jumped over the lazy dog 如果我们想要在这个句子的末尾添加一些文本，我们会发现 i 命令不能完成任务，因为我们 不能把光标移到行尾。 vi 提供了追加文本的命令，明智地命名为 a 命令，如果我们把光标移动到行尾，输入 a 光标就会越过行尾，vi 进入插入模式。这样就允许我们添加更多的文本。 The quick brown fox jumped over the lazy dog. It was cool. 记住按下 Esc 按键来退出插入模式 。 因为我们几乎总是想要在行尾附加文本，所以 vi 提供了一种快捷方式来移动到当前行的末 尾，并且能添加文本，它是 A 命令。 试着用一下它，给文件添加更多行。首先，使用 &quot;0&quot;(零) 命令，将光标移动到行首；现在我们输入&quot;A&quot;，来添加以下文本行： The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 Line 5 再一次，按下 Esc 按键退出插入模式。 正如我们所看到的，大 A 命令非常有用，因为在启动插入模式之前，它把光标移到了行尾 。 打开一行 我们插入文本的另一种方式是 “打开” 一行；这会在存在的两行之间插入一个空白行，并且进入插入模式，这种方式有两个变体： 命令 打开行 o 当前行的下方打开一行 O 当前行的上方打开一行 我们可以演示一下：把光标放到 &quot;Line 3&quot; 上，按下小 o 按键 The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 line 4 line 5 在第三行之下打开了新的一行，并且进入插入模式。按下 Esc，退出插入模式。 按下 u 按键，撤销我们的修改。 按下大 O 按键在光标之上打开新的一行 。 The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 Line 5 按下 Esc 按键，退出插入模式，并且按下 u 按键，撤销我们的更改。 删除文本 正如我们期望的，vi 提供了各种各样的方式来删除文本，所有的方式包含一个或两个按键。 首先，x 按键会删除光标位置的一个字符，可以在 x 命令之前带上一个数字来指明要删除的字符个数。 d 按键更通用一些。 类似 x 命令，d 命令之前可以带上一个数字，来指定要执行的删除次数；另外，d 命令之后总是带上一个移动命令，用来控制删除的范围 这里有些实例 命令 删除的文本 x 当前字符 3x 当前字符及其后的两个字符 dd 当前行 5dd 当前行及随后的四行文本 dW 从光标位置开始到下一个单词的开头 d$ 从光标位置开始到当前行的行尾 d0 从光标位置开始到当前行的行首 dˆ 从光标位置开始到文本行的第一个非空字符 dG 从当前行到文件的末尾 d20G 从当前行到文件的第 20 行 把光标放到第一行单词 &quot;It&quot; 之上，重复按下 x 按键直到删除剩下的部分。 下一步，重复按下 u 按键直到恢复原貌。 注意：真正的 vi 只是支持单层面的 undo 命令。 vim 则支持多个层面的。 我们再次执行删除命令，这次使用 d 命令。 还是移动光标到单词 &quot;It&quot; 之上，按下 dW 来删除单词 。 The quick brown fox jumped over the lazy dog. was cool. Line 2 Line 3 Line 4 Line 5 按下 d$ 删除从光标位置到行尾的文本。 The quick brown fox jumped over the lazy dog. Line 2 Line 3 Line 4 Line 5 按下 dG 按键删除从当前行到文件末尾的所有行。 ~ .... 连续按下 u 按键三次，来恢复删除部分。 剪切，复制和粘贴文本 这个 d 命令不仅删除文本，它还 &quot;剪切&quot; 文本。 每次我们使用 d 命令，删除的部分被复制到一个粘贴缓冲区中 (看作剪切板)。 稍后我们可以执行小 p 命令把剪切板中的文本粘贴到光标位置之后，或者是大 P 命令把文本粘贴到光标之前。 y 命令用来 &quot;yank&quot;(copy) [– &quot;拉&quot;(复制)] 文本，和 d 命令剪切文本的方式差不多。 这里有些把 y 命令和各种移动命令结合起来使用的实例。 命令 复制的内容 yy 当前行 5yy 当前行及随后的四行文本 yW 从当前光标位置到下一个单词的开头 y$ 从当前光标位置到当前行的末尾 y0 从当前光标位置到行首 yˆ 从当前光标位置到文本行的第一个非空字符 yG 从当前行到文件末尾 y20G 从当前行到文件的第 20 行 我们试着做些复制和粘贴工作。 把光标放到文本第一行，输入 yy 来复制当前行。 下一步，把光标移到最后一行(G)，输入小写的 p 把复制的一行粘贴到当前行的下面。 The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 Line 5 The quick brown fox jumped over the lazy dog. It was cool. 和以前一样，u 命令会撤销我们的修改。 光标仍然位于文件的最后一行，输入大写的 P 命令把所复制的文本粘贴到当前行之上。 The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 The quick brown fox jumped over the lazy dog. It was cool. Line 5 试着执行上表中一些其他的 y 命令，了解小写 p 和大写 P 命令的行为。 当你完成练习之后，把文件恢复原样。 连接行 vi 对于行的概念相当严格，通常，不可能把光标移到行尾，再删除行尾结束符 (回车符) 来连接当前行和它下面的一行。 由于这个原因，vi 提供了一个特定的命令，大写的 J (不要与小写的 j 混淆了, j 是用来移动光标的) 把行与行之间连接起来。 如果我们把光标放到 line 3 上，输入大写的 J 命令，看看发生什么情况。 The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 Line 5 查找和替换 vi 能够把光标移动到搜索到的匹配项上。 vi 可以在单一行或整个文件中运用这个功能。 它也可以在有或没有用户确认的情况下实现文本替换。 查找一行 f 命令查找一行，移动光标到下一个所指定的字符上。 例如，命令 fa 会把光标定位到同一行中下一个出现的 &quot;a&quot; 字符上。 在一行中执行了字符的查找命令之后，通过输入 &quot;;&quot; 分号来重复这个查找。 查找整个文件 移动光标到下一个出现的单词或短语上，使用 / 命令。这个命令和我们之前在 less 程序中学到的一样。 当你输入 / 命令后，一个 &quot;/&quot; 字符会出现在屏幕底部。 下一步，输入要查找的单词或短语后，按下回车，光标就会移动到下一个包含所查找字符串的位置。 通过 n 命令来重复先前的查找。 这里有个例子： The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 Line 5 把光标移动到文件的第一行。 输入 /Line 然后键入回车。 光标会移动到第二行。 下一步，输入 n, 光标移到第三行 重复这个 n 命令，光标会继续向下移动直到遍历了所有的匹配项。 虽然目前我们只是使用了单词和短语来作为我们的查找模式，但是 vi 允许使用正则表达式，一种强大的用来表示复杂文本模式的方法。 我们将会在随后的章节里面详尽地介绍正则表达式。 全局查找和替代 vi 使用 ex 命令来执行查找和 替换(replace) 操作 (vi 中叫做 “substitution” [– 中文也是代替, 替换的意思])。 把整个文件中的单词“Line”，更改为“line”。 我们输入以下命令： :%s/Line/line/g 我们把这个命令分解为几个单独的部分，看一下每部分的含义： 条目 含义 : 冒号字符运行一个 ex 命令 % 指定要操作的行数 % 是一个快捷方式, 表示从第一行到最后一行另外, 操作范围也可以用数字代替例如 1,5 (因为我们的文件只有 5 行文本)或者用 1,$ 来代替, 意思是 &quot;从第一行到文件的最后一行&quot; 如果省略了文本行的范围, 那么操作只对当前行生效 s 指定操作在这种情况下是, 替换 (查找与替代) /Line/line 查找类型与替代文本 g 这是 &quot;全局&quot; 的意思意味着对文本行中所有匹配的字符串执行查找和替换操作如果省略 g, 则只替换每个文本行中第一个匹配的字符串 执行完查找和替代命令之后，我们的文件看起来像这样： The quick brown fox jumped over the lazy dog. It was cool. line 2 line 3 line 4 line 5 我们也可以指定一个需要用户确认的替换命令，通过添加一个 &quot;c&quot; 字符到这个命令的末尾来完成这个替换命令。 例如： :%s/line/Line/gc 这个命令会把我们的文件恢复先前的模样。然而，在执行每个替换命令之前，vi 会停下来，通过下面的信息，来要求我们确认这个替换。 replace with Line (y/n/a/q/l/^E/^Y)? 括号中的每个字符都是一个可能的选择，如下所示。 按键 行为 y 执行替换操作 n 跳过这个匹配的实例 a 对这个及随后所有匹配的字符串执行替换操作 q 或者 esc 退出替换操作 l 执行这次替换并退出l 是 &quot;last&quot; 的简写 Ctrl-e, Ctrl-y 分别是向下滚动和向上滚动用于查看建议替换的上下文 如果你输入 y，则执行这个替换，输入 n 则会导致 vi 跳过这个实例，而移到下一个匹配项上。 编辑多个文件 同时能够编辑多个文件是很有用的，你可能需要更改多个文件或者从一个文件复制内容到另一个文件。 通过 vi，我们可以打开多个文件来编辑，只要在命令行中指定要编辑的文件名 vi file1 file2 file3... 我们先退出已经存在的 vi 会话，然后创建一个新文件来编辑。 输入 :wq 来退出 vi 并且保存所做的修改。 下一步，我们将在 home(家) 目录下创建一个额外用来玩耍的文件，通过获取从 ls 命令的输出，来创建这个文件 ls -l /usr/bin &gt; ls-output.txt 用 vi 来编辑我们的原文件和新创建的文件。 vi foo.txt ls-output.txt vi 启动，我们会看到第一个文件显示出来。 The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 Line 5 文件之间转换 从这个文件转到下一个文件，使用这个 ex 命令： :n 回到先前的文件使用： :N 当我们从一个文件移到另一个文件时，如果当前文件没有保存修改，vi 会阻止我们转换文件，这是 vi 强制执行的政策。 在命令之后添加感叹号，可以强迫 vi 放弃修改而转换文件。 另外，上面所描述的转换方法，vim (和一些版本的 vi) 也提供了一些 ex 命令，这些命令使多个文件更容易管理。 我们可以使用 :buffers 命令查看正在编辑的文件列表。 运行这个命令后，屏幕顶部就会显示出一个文件列表。 :buffers 1 %a &quot;foo.txt&quot; line 1 2 &quot;ls-output.txt&quot; line 0 Press ENTER or type command to continue 转换到其它缓冲区(文件), 输入 :buffers 缓冲区数字。 例如，从包含 foot.txt 文件的缓冲区1，转换到包含 ls-output.txt 文件的缓冲区2，应该输入 :buffer 2 我们的屏幕上将会显示的是第二个文件。 打开编辑额外的文件 当我们正在编辑文件时，同样可以打开其它文件加入进来。 ex 的 :e 命令(&quot;edit&quot; 的缩写)后面跟着一个想要打开的额外文件名。 我们先退出目前的编辑模式，返回到命令行，使用 vi 只打开一个文件： vi foo.txt 添加第二个文件，输入命令： :e ls-output.txt 它会显示在屏幕上，并且，通过验证，第一个文件仍然存在。 :buffers 1 # &quot;foo.txt&quot; line 1 2 %a &quot;ls-output.txt&quot; line 0 Press ENTER or type command to continue 注意：你不能通过 :n 或 :N 命令在由 :e 命令加载的文件之间进行切换。 这时要使用 :buffer 命令，其后加上缓冲区号码，来转换文件。 从一个文件复制内容到另一个文件 当我们编辑多个文件时，经常地要复制文件的一部分到另一个正在编辑的文件。 使用之前我们学到的拉 (yank) 和粘贴命令，这很容易完成。 以打开的两个文件为例，首先转换到缓冲区 1 (foo.txt)， 输入： :buffer 1 我们应该得到以下输出： The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 Line 5 下一步, 把光标移到第一行，并且输入 yy 来复制这一行。 转换到第二个缓冲区, 输入： :buffer 2 现在屏幕会包含一些文件列表 (这里只列出了一部分)： total 343700 -rwxr-xr-x 1 root root 31316 2007-12-05 08:58 [ -rwxr-xr-x 1 root root 8240 2015-12-09 13:39 411toppm -rwxr-xr-x 1 root root 111276 2016-01-31 13:36 a2p -rwxr-xr-x 1 root root 25368 2014-10-06 20:16 a52dec -rwxr-xr-x 1 root root 11532 2015-05-04 17:43 aafire -rwxr-xr-x 1 root root 7292 2015-05-04 17:43 aainfo 移动光标到第一行，输入 p 命令把我们从前面文件中复制的一行粘贴到这个文件中： total 343700 The quick brown fox jumped over the lazy dog. It was cool. -rwxr-xr-x 1 root root 31316 2015-12-05 08:58 [ -rwxr-xr-x 1 root root 8240 2015-12-09 13:39 411toppm -rwxr-xr-x 1 root root 111276 2016-01-31 13:36 a2p -rwxr-xr-x 1 root root 25368 2014-10-06 20:16 a52dec -rwxr-xr-x 1 root root 11532 2015-05-04 17:43 aafire -rwxr-xr-x 1 root root 7292 2015-05-04 17:43 aainfo 插入整个文件到另一个文件 也有可能把整个文件插入到我们所编辑的文件中。 看一下实际操作，结束 vi 会话，重新启动一个只打开一个文件的 vi 会话。 vi ls-output.txt 再一次看到我们的文件列表： total 343700 -rwxr-xr-x 1 root root 31316 2015-12-05 08:58 [ -rwxr-xr-x 1 root root 8240 2015-12-09 13:39 411toppm -rwxr-xr-x 1 root root 111276 2016-01-31 13:36 a2p -rwxr-xr-x 1 root root 25368 2014-10-06 20:16 a52dec -rwxr-xr-x 1 root root 11532 2015-05-04 17:43 aafire -rwxr-xr-x 1 root root 7292 2015-05-04 17:43 aainfo 移动光标到第三行，然后输入以下 ex 命令： :r foo.txt 这个 :r 命令 (是 &quot;read&quot; 的简称) 把指定的文件插入到光标位置之前。 现在屏幕应该看起来像这样： total 343700 -rwxr-xr-x 1 root root 31316 2015-12-05 08:58 [ -rwxr-xr-x 1 root root 8240 2015-12-09 13:39 411toppm The quick brown fox jumped over the lazy dog. It was cool. Line 2 Line 3 Line 4 Line 5 -rwxr-xr-x 1 root root 111276 2016-01-31 13:36 a2p -rwxr-xr-x 1 root root 25368 2014-10-06 20:16 a52dec -rwxr-xr-x 1 root root 11532 2015-05-04 17:43 aafire -rwxr-xr-x 1 root root 7292 2015-05-04 17:43 aainfo 保存工作 像 vi 中的其它操作一样，有几种不同的方法来保存我们所修改的文件。 我们已经研究了 :w 这个 ex 命令, 但还有几种方法，可能我们也觉得有帮助，在命令模式下，输入 ZZ 就会保存并退出当前文件。 同样地, ex 命令 :wq 把 :w 和 :q 命令结合到一起来完成保存和退出任务。 这个 :w 命令也可以指定可选的文件名。 这个的作用就如 &quot;另存为&quot;。 例如，如果我们正在编辑 foo.txt 文件，想要保存一个副本，叫做 foo1.txt，那么我们可以执行以下命令 :w foo1.txt 注意：当上面的命令以一个新名字保存文件时，但它并没有更改你正在编辑的文件的名字，如果你继续编辑的话，你还是在编辑文件 foo.txt，而不是 foo1.txt。 拓展阅读 即使把这章所学的内容都加起来，我们也只是学了 vi 和 vim 的一点儿皮毛而已。 这里有一些在线的资料，你可以用来继续 vi 学习之旅。 学习 vi 编辑器－一本来自于 Wikipedia 的 Wikibook, 是一本关于 vi 的简要指南, 并介绍了几个类似 vi 的程序, 其中包括 vim。 它可以在下面链接中得到: http://en.wikibooks.org/wiki/Vi The Vim Book － vim 项目, 一本 570 页的书籍, 包含了(几乎)所有的 vim 特性。 你能在下面链接中找到它: ftp://ftp.vim.org/pub/vim/doc/book/vimbook-OPL.pdf Wikipedia 上关于 vi 的创始人 Bill Joy 的文章: http://en.wikipedia.org/wiki/Bill_Joy Wikipedia 上关于 vim 的作者 Bram Moolenaar 的文章: http://en.wikipedia.org/wiki/Bram_Moolenaar 参考: happypeter/TLCL The Linux Command Line","@type":"BlogPosting","headline":"vi 常用命令","dateModified":"2018-03-09T00:00:00+08:00","datePublished":"2018-03-09T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://empvalley.com/2018/03/09/vi-commands/"},"@context":"https://schema.org"}</script> <meta name="keywords" content="vi"/> <link type="application/atom+xml" rel="alternate" href="https://empvalley.com/feed.xml" title="晨霜’s Blog"/> <link href='/assets/stylesheets/blog.css' rel="stylesheet" type="text/css"> <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script> <script>window.Modernizr||document.write('<script src="/assets/javascripts/modernizr-2.8.3.min.js"><\/script>');</script> <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> <script>window.jQuery||document.write('<script src="/assets/javascripts/jquery-3.3.1.min.js"><\/script>');</script> <script src="//cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script> <script>window.Pace||document.write('<script src="/assets/javascripts/pace.min.js"><\/script>');</script> <script>(function(b,m,h,a,g){b[a]=b[a]||[];b[a].push({"gtm.start":new Date().getTime(),event:"gtm.js"});var k=m.getElementsByTagName(h)[0],e=m.createElement(h),c=a!="dataLayer"?"&l="+a:"";e.async=true;e.src="https://www.googletagmanager.com/gtm.js?id="+g+c;k.parentNode.insertBefore(e,k)})(window,document,"script","dataLayer","GTM-WLHQF68");</script> </head> <body> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WLHQF68" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript> <!--[if IE]><p class="site-notice">您正在使用一个过时的网页浏览器。请<a href="http://browsehappy.com/" target="_blank">升级您的浏览器</a>或<a href="http://www.google.com/chromeframe/?redirect=true" target="_blank">开启 Google Chrome Frame</a> 来提高用户体验。</p><![endif]--> <noscript> <p class="site-notice">本网站需要 JavaScript。请查阅指南来<a href="http://www.enable-javascript.com/" target="_blank">给您的浏览器开启 JavaScript 功能</a>。</p> </noscript> <div class="nav-wrapper overlay-wrapper"> <div class="nav-form overlay-form"> <span class="overlay-header menu">菜单</span> <a class="btn-close">关闭</a> <div class="results"> <ul> <li><a href="/blog/categories/">文章分类</a></li> <li><a href="/blog/tags/">文章标签</a></li> <li><a href="/">关于</a></li> </ul> </div> </div> </div> <div class="search-wrapper overlay-wrapper"> <div class="search-form overlay-form"> <input type="text" class="overlay-header search-field" placeholder="搜索..."> <a class="btn-close">关闭</a> <ul class="results"></ul> </div> </div> <div id="page" class="hentry"> <header class="the-header"> <div class="unit-head"> <div class="unit-inner unit-head-inner"> <nav class="nav-global"> <ul> <li class="logo nav-link"> <button class="btn-menu" title="菜单"></button> <a href="/blog/">晨霜’s Blog</a> <!--[if !IE]>--> <button class="btn-search" title="搜索"></button> <!--<![endif]--> </li> <li class="nav-link"><a title="文章分类" href="/blog/categories/">文章分类</a></li> <li class="nav-link"><a title="文章标签" href="/blog/tags/">文章标签</a></li> <!--[if !IE]>--> <li class="nav-link"><a title="搜索" class="btn-search" href="#">搜索</a></li> <!--<![endif]--> </ul> </nav> </div> </div> </header> <div class="body animated fadeInDown" role="main"> <div class="unit-body"> <div class="unit-inner unit-body-inner"> <div class="entry-content"> <article class="unit-article layout-post"> <div class="unit-inner unit-article-inner"> <div itemscope itemtype="http://schema.org/Article" class="content"> <header> <div class="unit-head"> <div class="unit-inner unit-head-inner"> <h1 class="entry-title" itemprop="name">vi 常用命令</h1> </div> </div> </header> <div class="bd article-content"> <div class="entry-content"> <div class="meta"> <p class="date-publish"> 发表信息: <time itemprop="datePublished" class="date-pub updated" title="2018-03-09T00:00:00+08:00" datetime="2018-03-09T00:00:00+08:00">March 09, 2018 </time> by <a class="author" href="/" rel="author" title="显示作者"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name">晨霜</span> </span> </a> <a class="license-icon" rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" title="显示许可证"> <img alt="Creative Commons Licence" style="border-width:0" src="/assets/images/theme/cc-by-sa.png" height="16" width="80"/> </a> </p> <ul class="list-category list-linear"> <li class="list-head">文章分类: </li> <li> <a href="/blog/categories/#技术" title="技术"> 技术 <span>32</span></a> </li> </ul> <ul class="list-tag list-linear"> <li class="list-head">文章标签: </li> <li> <a href="/blog/tags/#vi" title="vi">vi <span>1</span></a> </li> </ul> </div> <div itemprop="articleBody"> <ul class="toc" id="markdown-toc"> <li><a href="#heading-为什么我们应该学习-vi" id="markdown-toc-heading-为什么我们应该学习-vi">为什么我们应该学习 vi</a></li> <li><a href="#heading-背景介绍" id="markdown-toc-heading-背景介绍">背景介绍</a></li> <li><a href="#heading-启动和停止-vi" id="markdown-toc-heading-启动和停止-vi">启动和停止 vi</a></li> <li><a href="#heading-创建新文件" id="markdown-toc-heading-创建新文件">创建新文件</a></li> <li><a href="#heading-插入模式" id="markdown-toc-heading-插入模式">插入模式</a></li> <li><a href="#heading-保存我们的工作" id="markdown-toc-heading-保存我们的工作">保存我们的工作</a></li> <li><a href="#heading-移动光标" id="markdown-toc-heading-移动光标">移动光标</a></li> <li><a href="#heading-基本编辑" id="markdown-toc-heading-基本编辑">基本编辑</a> <ul> <li><a href="#heading-追加文本" id="markdown-toc-heading-追加文本">追加文本</a></li> <li><a href="#heading-打开一行" id="markdown-toc-heading-打开一行">打开一行</a></li> <li><a href="#heading-删除文本" id="markdown-toc-heading-删除文本">删除文本</a></li> <li><a href="#heading-剪切复制和粘贴文本" id="markdown-toc-heading-剪切复制和粘贴文本">剪切，复制和粘贴文本</a></li> <li><a href="#heading-连接行" id="markdown-toc-heading-连接行">连接行</a></li> </ul> </li> <li><a href="#heading-查找和替换" id="markdown-toc-heading-查找和替换">查找和替换</a> <ul> <li><a href="#heading-查找一行" id="markdown-toc-heading-查找一行">查找一行</a></li> <li><a href="#heading-查找整个文件" id="markdown-toc-heading-查找整个文件">查找整个文件</a></li> <li><a href="#heading-全局查找和替代" id="markdown-toc-heading-全局查找和替代">全局查找和替代</a></li> </ul> </li> <li><a href="#heading-编辑多个文件" id="markdown-toc-heading-编辑多个文件">编辑多个文件</a> <ul> <li><a href="#heading-文件之间转换" id="markdown-toc-heading-文件之间转换">文件之间转换</a></li> <li><a href="#heading-打开编辑额外的文件" id="markdown-toc-heading-打开编辑额外的文件">打开编辑额外的文件</a></li> <li><a href="#heading-从一个文件复制内容到另一个文件" id="markdown-toc-heading-从一个文件复制内容到另一个文件">从一个文件复制内容到另一个文件</a></li> <li><a href="#heading-插入整个文件到另一个文件" id="markdown-toc-heading-插入整个文件到另一个文件">插入整个文件到另一个文件</a></li> </ul> </li> <li><a href="#heading-保存工作" id="markdown-toc-heading-保存工作">保存工作</a></li> <li><a href="#heading-拓展阅读" id="markdown-toc-heading-拓展阅读">拓展阅读</a></li> </ul> <h2 id="heading-为什么我们应该学习-vi">为什么我们应该学习 vi</h2> <p>在现在这个图形编辑器和易于使用的基于文本编辑器的时代，比如说 nano，为什么我们还 应该学习 vi 呢？下面有三个充分的理由：</p> <ul> <li> <p>vi 很多系统都预装。</p> <p>如果我们的系统没有图形界面，比方说一台远端服务器或者是一个 X 配置损坏了的本地系统，那么 vi 就成了我们的救星。</p> <p>虽然 nano 逐渐流行起来，但是它还没有普及。</p> <p>POSIX，这套 Unix 系统中程序兼容的标准，就要求系统要预装 vi。</p> </li> <li> <p>vi 是轻量级且执行快速的编辑器。</p> <p>对于许多任务来说，启动 vi 比起在菜单中找到一个图形化文本编辑器，再等待编辑器数倍兆字节的数据加载而言，要容易的多。</p> <p>另外，vi 是为了加快输入速度而设计的。</p> <p>我们将会看到，当一名熟练的 vi 用户在编辑文件时，他或她的手从不需要移开键盘。</p> </li> <li> <p>我们不希望其他 Linux 和 Unix 用户把我们看作胆小鬼</p> </li> </ul> <p>好吧，可能只有两个充分的理由。</p> <h2 id="heading-背景介绍">背景介绍</h2> <p>第一版 vi 是在 1976 由 Bill Joy 写成的，当时他是加州大学伯克利分校的学生，后来他共同创建了 Sun 微系统公司。</p> <p>vi 这个名字来源于单词 "visual"，因为它打算在带有可移动光标的视频终端上编辑文本。</p> <p>在发明可视化编辑器之前，有一次只能操作一行文本的行编辑器。为了指定一个修改，我们告诉行编辑器到一个特殊行并且说明做什么修改，比方说添加或删除文本。</p> <p>视频终端 (而不是基于打印机的终端，像电传打印机) 的出现，可视化编辑成为可能。</p> <p>vi 实际上整合了一个强大的叫做 ex 行编辑器，所以我们在使用 vi 时能运行行编辑命令。</p> <h2 id="heading-启动和停止-vi">启动和停止 vi</h2> <p>启动 vi: <code class="language-plaintext highlighter-rouge">vi</code></p> <p>停止 vi: <code class="language-plaintext highlighter-rouge">:q</code></p> <p>强制退出: <code class="language-plaintext highlighter-rouge">q!</code></p> <p>注意：冒号是命令的一部分</p> <p>小贴士：如果你在 vi 中 "迷失" 了，试着按下 Esc 键两次来找到路(回到普通模式)。</p> <h2 id="heading-创建新文件">创建新文件</h2> <p>启动 vi 时, 传递给 vi 一个不存在的文件名，就创建了一个新文件：</p> <p><code class="language-plaintext highlighter-rouge">vi foo.txt</code></p> <p>每行开头的波浪号 ("~") 指示那一行不存在文本，这表示我们有一个空文件，还没有输入 任何字符。</p> <p>小贴士：vi 是一个模式编辑器。</p> <p>当 vi 启动后，进入的是命令模式；这种模式下，几乎每个按键都是一个命令，所以如果 我们打算输入字符，vi 会发疯，弄得一团糟。</p> <h2 id="heading-插入模式">插入模式</h2> <p>为了在文件中添加文本，首先我们必须进入插入模式。</p> <p>按下 "i" 按键进入插入模式，现在我们能输入一些文本了，试着输入这些文本：</p> <p><code class="language-plaintext highlighter-rouge">The quick brown fox jumped over the lazy dog.</code></p> <p>按下 <code class="language-plaintext highlighter-rouge">Esc</code> 按键, 退出插入模式并返回命令模式。</p> <h2 id="heading-保存我们的工作">保存我们的工作</h2> <p>为了保存我们刚才对文件所做的修改，我们必须在命令模式下输入一个 ex 命令，通过按下 ":" 键，这很容易完成。</p> <p>按下冒号键之后，一个冒号字符应该出现在屏幕的底部： <code class="language-plaintext highlighter-rouge">:</code></p> <p>为了写入我们修改的文件，我们在冒号之后输入 "w" 字符，然后按下回车键: <code class="language-plaintext highlighter-rouge">:w</code></p> <p>文件将会写入到硬盘，并且我们应该在屏幕底部得到一个确认信息，就像这样：</p> <p><code class="language-plaintext highlighter-rouge">"foo.txt" [New] 1L, 46C written</code></p> <p>小贴示：如果你阅读 vim 的文档，你注意到 (混淆地) 命令模式被叫做普通模式，ex 命令叫做命令模式，当心。</p> <h2 id="heading-移动光标">移动光标</h2> <p>当在 vi 命令模式下时，vi 提供了大量的移动命令，其中一些是与 less 阅读器共享的。这里列举了一些：</p> <table> <thead> <tr> <th style="text-align: center">按键</th> <th style="text-align: center">移动光标</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">l 或 右箭头</td> <td style="text-align: center">向右移动一个字符</td> </tr> <tr> <td style="text-align: center">h 或 左箭头</td> <td style="text-align: center">向左移动一个字符</td> </tr> <tr> <td style="text-align: center">j 或 下箭头</td> <td style="text-align: center">向下移动一行</td> </tr> <tr> <td style="text-align: center">k 或 上箭头</td> <td style="text-align: center">向上移动一行</td> </tr> <tr> <td style="text-align: center">0 (零按键)</td> <td style="text-align: center">移动到当前行的行首</td> </tr> <tr> <td style="text-align: center">ˆ</td> <td style="text-align: center">移动到当前行的第一个非空字符</td> </tr> <tr> <td style="text-align: center">$</td> <td style="text-align: center">移动到当前行的末尾</td> </tr> <tr> <td style="text-align: center">w</td> <td style="text-align: center">移动到下一个单词或标点符号的开头</td> </tr> <tr> <td style="text-align: center">W</td> <td style="text-align: center">移动到下一个单词的开头, 忽略标点符号</td> </tr> <tr> <td style="text-align: center">b</td> <td style="text-align: center">移动到上一个单词或标点符号的开头</td> </tr> <tr> <td style="text-align: center">B</td> <td style="text-align: center">移动到上一个单词的开头, 忽略标点符号</td> </tr> <tr> <td style="text-align: center">Ctrl-f 或 Page Down</td> <td style="text-align: center">向下翻一页</td> </tr> <tr> <td style="text-align: center">Ctrl-b 或 Page Up</td> <td style="text-align: center">向上翻一页</td> </tr> <tr> <td style="text-align: center">numberG</td> <td style="text-align: center">移动到第 number 行. 例如: 1G 移动到文件的第一行</td> </tr> <tr> <td style="text-align: center">g</td> <td style="text-align: center">移动到文件的开端</td> </tr> <tr> <td style="text-align: center">G</td> <td style="text-align: center">移动到文件末尾</td> </tr> </tbody> </table> <p>为什么 h、j、k 和 l 按键被用来移动光标呢？</p> <p>因为在开发 vi 之初，并不是所有的视频终端都有箭头按键，熟练的打字员可以使用规则的键盘按键来移动光标，他们的手从不需要移开键盘。</p> <p>vi 中的许多命令都可以在前面加上一个数字，比方说上面提到的 "G" 命令，在命令之前加上一个数字，我们就可以指定命令执行的次数。</p> <p>例如，命令 "5j" 导致 vi 向下移动 5 行。</p> <h2 id="heading-基本编辑">基本编辑</h2> <p>大多数编辑工作由一些基本的操作组成，比如说插入文本，删除文本和通过剪切和粘贴来移动文本。</p> <p>vi，当然以它自己的独特方式来支持所有的操作。</p> <p>vi 也提供了有限的撤销形式；如果我们按下 "u" 按键，当在命令模式下，vi 将会撤销你所做的最后一次修改，当我们试着执行一些基本的编辑命令时，这会很方便。</p> <h3 id="heading-追加文本">追加文本</h3> <p>vi 有几种不同进入插入模式的方法。我们已经使用了 i 命令来插入文本，让我们返回到我们的 foo.txt 文件中, 呆一会儿。</p> <p><code class="language-plaintext highlighter-rouge">The quick brown fox jumped over the lazy dog </code></p> <p>如果我们想要在这个句子的末尾添加一些文本，我们会发现 i 命令不能完成任务，因为我们 不能把光标移到行尾。</p> <p>vi 提供了追加文本的命令，明智地命名为 <code class="language-plaintext highlighter-rouge">a</code> 命令，如果我们把光标移动到行尾，输入 <code class="language-plaintext highlighter-rouge">a</code> 光标就会越过行尾，vi 进入插入模式。这样就允许我们添加更多的文本。</p> <p><code class="language-plaintext highlighter-rouge">The quick brown fox jumped over the lazy dog. It was cool.</code></p> <p>记住按下 Esc 按键来退出插入模式 。</p> <p>因为我们几乎总是想要在行尾附加文本，所以 vi 提供了一种快捷方式来移动到当前行的末 尾，并且能添加文本，它是 <code class="language-plaintext highlighter-rouge">A</code> 命令。</p> <p>试着用一下它，给文件添加更多行。首先，使用 "0"(零) 命令，将光标移动到行首；现在我们输入"A"，来添加以下文本行：</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The quick brown fox jumped over the lazy dog. It was cool.
Line 2
Line 3
Line 4
Line 5 
</code></pre></div></div> <p>再一次，按下 Esc 按键退出插入模式。</p> <p>正如我们所看到的，大 A 命令非常有用，因为在启动插入模式之前，它把光标移到了行尾 。</p> <h3 id="heading-打开一行">打开一行</h3> <p>我们插入文本的另一种方式是 “打开” 一行；这会在存在的两行之间插入一个空白行，并且进入插入模式，这种方式有两个变体：</p> <table> <thead> <tr> <th style="text-align: center">命令</th> <th style="text-align: center">打开行</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">o</td> <td style="text-align: center">当前行的下方打开一行</td> </tr> <tr> <td style="text-align: center">O</td> <td style="text-align: center">当前行的上方打开一行</td> </tr> </tbody> </table> <p>我们可以演示一下：把光标放到 "Line 3" 上，按下小 o 按键</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The quick brown fox jumped over the lazy dog. It was cool.
Line 2
Line 3

line 4
line 5
</code></pre></div></div> <p>在第三行之下打开了新的一行，并且进入插入模式。按下 Esc，退出插入模式。</p> <p>按下 u 按键，撤销我们的修改。</p> <p>按下大 O 按键在光标之上打开新的一行 。</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The quick brown fox jumped over the lazy dog. It was cool.
Line 2

Line 3
Line 4
Line 5
</code></pre></div></div> <p>按下 Esc 按键，退出插入模式，并且按下 u 按键，撤销我们的更改。</p> <h3 id="heading-删除文本">删除文本</h3> <p>正如我们期望的，vi 提供了各种各样的方式来删除文本，所有的方式包含一个或两个按键。</p> <p>首先，x 按键会删除光标位置的一个字符，可以在 x 命令之前带上一个数字来指明要删除的字符个数。</p> <p>d 按键更通用一些。</p> <p>类似 x 命令，d 命令之前可以带上一个数字，来指定要执行的删除次数；另外，d 命令之后总是带上一个移动命令，用来控制删除的范围</p> <p>这里有些实例</p> <table> <thead> <tr> <th style="text-align: center">命令</th> <th style="text-align: center">删除的文本</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">x</td> <td style="text-align: center">当前字符</td> </tr> <tr> <td style="text-align: center">3x</td> <td style="text-align: center">当前字符及其后的两个字符</td> </tr> <tr> <td style="text-align: center">dd</td> <td style="text-align: center">当前行</td> </tr> <tr> <td style="text-align: center">5dd</td> <td style="text-align: center">当前行及随后的四行文本</td> </tr> <tr> <td style="text-align: center">dW</td> <td style="text-align: center">从光标位置开始到下一个单词的开头</td> </tr> <tr> <td style="text-align: center">d$</td> <td style="text-align: center">从光标位置开始到当前行的行尾</td> </tr> <tr> <td style="text-align: center">d0</td> <td style="text-align: center">从光标位置开始到当前行的行首</td> </tr> <tr> <td style="text-align: center">dˆ</td> <td style="text-align: center">从光标位置开始到文本行的第一个非空字符</td> </tr> <tr> <td style="text-align: center">dG</td> <td style="text-align: center">从当前行到文件的末尾</td> </tr> <tr> <td style="text-align: center">d20G</td> <td style="text-align: center">从当前行到文件的第 20 行</td> </tr> </tbody> </table> <p>把光标放到第一行单词 "It" 之上，重复按下 x 按键直到删除剩下的部分。</p> <p>下一步，重复按下 u 按键直到恢复原貌。</p> <p>注意：真正的 vi 只是支持单层面的 undo 命令。</p> <p>vim 则支持多个层面的。</p> <p>我们再次执行删除命令，这次使用 d 命令。</p> <p>还是移动光标到单词 "It" 之上，按下 dW 来删除单词 。</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The quick brown fox jumped over the lazy dog. was cool.
Line 2
Line 3
Line 4
Line 5
</code></pre></div></div> <p>按下 d$ 删除从光标位置到行尾的文本。</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The quick brown fox jumped over the lazy dog.
Line 2
Line 3
Line 4
Line 5
</code></pre></div></div> <p>按下 dG 按键删除从当前行到文件末尾的所有行。</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~
.... 
</code></pre></div></div> <p>连续按下 u 按键三次，来恢复删除部分。</p> <h3 id="heading-剪切复制和粘贴文本">剪切，复制和粘贴文本</h3> <p>这个 d 命令不仅删除文本，它还 "剪切" 文本。</p> <p>每次我们使用 d 命令，删除的部分被复制到一个粘贴缓冲区中 (看作剪切板)。</p> <p>稍后我们可以执行小 p 命令把剪切板中的文本粘贴到光标位置之后，或者是大 P 命令把文本粘贴到光标之前。</p> <p>y 命令用来 "yank"(copy) [– "拉"(复制)] 文本，和 d 命令剪切文本的方式差不多。</p> <p>这里有些把 y 命令和各种移动命令结合起来使用的实例。</p> <table> <thead> <tr> <th style="text-align: center">命令</th> <th style="text-align: center">复制的内容</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">yy</td> <td style="text-align: center">当前行</td> </tr> <tr> <td style="text-align: center">5yy</td> <td style="text-align: center">当前行及随后的四行文本</td> </tr> <tr> <td style="text-align: center">yW</td> <td style="text-align: center">从当前光标位置到下一个单词的开头</td> </tr> <tr> <td style="text-align: center">y$</td> <td style="text-align: center">从当前光标位置到当前行的末尾</td> </tr> <tr> <td style="text-align: center">y0</td> <td style="text-align: center">从当前光标位置到行首</td> </tr> <tr> <td style="text-align: center">yˆ</td> <td style="text-align: center">从当前光标位置到文本行的第一个非空字符</td> </tr> <tr> <td style="text-align: center">yG</td> <td style="text-align: center">从当前行到文件末尾</td> </tr> <tr> <td style="text-align: center">y20G</td> <td style="text-align: center">从当前行到文件的第 20 行</td> </tr> </tbody> </table> <p>我们试着做些复制和粘贴工作。</p> <p>把光标放到文本第一行，输入 yy 来复制当前行。</p> <p>下一步，把光标移到最后一行(G)，输入小写的 p 把复制的一行粘贴到当前行的下面。</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The quick brown fox jumped over the lazy dog. It was cool.
Line 2
Line 3
Line 4
Line 5
The quick brown fox jumped over the lazy dog. It was cool.
</code></pre></div></div> <p>和以前一样，u 命令会撤销我们的修改。</p> <p>光标仍然位于文件的最后一行，输入大写的 P 命令把所复制的文本粘贴到当前行之上。</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The quick brown fox jumped over the lazy dog. It was cool.
Line 2
Line 3
Line 4
The quick brown fox jumped over the lazy dog. It was cool.
Line 5
</code></pre></div></div> <p>试着执行上表中一些其他的 y 命令，了解小写 p 和大写 P 命令的行为。</p> <p>当你完成练习之后，把文件恢复原样。</p> <h3 id="heading-连接行">连接行</h3> <p>vi 对于行的概念相当严格，通常，不可能把光标移到行尾，再删除行尾结束符 (回车符) 来连接当前行和它下面的一行。</p> <p>由于这个原因，vi 提供了一个特定的命令，大写的 J (不要与小写的 j 混淆了, j 是用来移动光标的) 把行与行之间连接起来。</p> <p>如果我们把光标放到 line 3 上，输入大写的 J 命令，看看发生什么情况。</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The quick brown fox jumped over the lazy dog. It was cool.
Line 2
Line 3 Line 4
Line 5 
</code></pre></div></div> <h2 id="heading-查找和替换">查找和替换</h2> <p>vi 能够把光标移动到搜索到的匹配项上。</p> <p>vi 可以在单一行或整个文件中运用这个功能。</p> <p>它也可以在有或没有用户确认的情况下实现文本替换。</p> <h3 id="heading-查找一行">查找一行</h3> <p>f 命令查找一行，移动光标到下一个所指定的字符上。</p> <p>例如，命令 fa 会把光标定位到同一行中下一个出现的 "a" 字符上。</p> <p>在一行中执行了字符的查找命令之后，通过输入 ";" 分号来重复这个查找。</p> <h3 id="heading-查找整个文件">查找整个文件</h3> <p>移动光标到下一个出现的单词或短语上，使用 / 命令。这个命令和我们之前在 less 程序中学到的一样。</p> <p>当你输入 / 命令后，一个 "/" 字符会出现在屏幕底部。</p> <p>下一步，输入要查找的单词或短语后，按下回车，光标就会移动到下一个包含所查找字符串的位置。</p> <p>通过 n 命令来重复先前的查找。</p> <p>这里有个例子：</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The quick brown fox jumped over the lazy dog. It was cool.
Line 2
Line 3
Line 4
Line 5
</code></pre></div></div> <p>把光标移动到文件的第一行。</p> <p>输入 <code class="language-plaintext highlighter-rouge">/Line </code></p> <p>然后键入回车。</p> <p>光标会移动到第二行。</p> <p>下一步，输入 n, 光标移到第三行</p> <p>重复这个 n 命令，光标会继续向下移动直到遍历了所有的匹配项。</p> <p>虽然目前我们只是使用了单词和短语来作为我们的查找模式，但是 vi 允许使用正则表达式，一种强大的用来表示复杂文本模式的方法。</p> <p>我们将会在随后的章节里面详尽地介绍正则表达式。</p> <h3 id="heading-全局查找和替代">全局查找和替代</h3> <p>vi 使用 ex 命令来执行查找和 替换(replace) 操作 (vi 中叫做 “substitution” [– 中文也是代替, 替换的意思])。</p> <p>把整个文件中的单词“Line”，更改为“line”。</p> <p>我们输入以下命令：</p> <p><code class="language-plaintext highlighter-rouge">:%s/Line/line/g </code></p> <p>我们把这个命令分解为几个单独的部分，看一下每部分的含义：</p> <table> <thead> <tr> <th style="text-align: center">条目</th> <th style="text-align: left">含义</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">:</td> <td style="text-align: left">冒号字符运行一个 ex 命令</td> </tr> <tr> <td style="text-align: center">%</td> <td style="text-align: left">指定要操作的行数<br/> % 是一个快捷方式, 表示从第一行到最后一行<br/>另外, 操作范围也可以用数字代替<br/>例如 1,5 (因为我们的文件只有 5 行文本)<br/>或者用 1,$ 来代替, 意思是 "从第一行到文件的最后一行" <br/>如果省略了文本行的范围, 那么操作只对当前行生效</td> </tr> <tr> <td style="text-align: center">s</td> <td style="text-align: left">指定操作<br/>在这种情况下是, 替换 (查找与替代)</td> </tr> <tr> <td style="text-align: center">/Line/line</td> <td style="text-align: left">查找类型与替代文本</td> </tr> <tr> <td style="text-align: center">g</td> <td style="text-align: left">这是 "全局" 的意思<br/>意味着对文本行中所有匹配的字符串执行查找和替换操作<br/>如果省略 g, 则只替换每个文本行中第一个匹配的字符串</td> </tr> </tbody> </table> <p>执行完查找和替代命令之后，我们的文件看起来像这样：</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The quick brown fox jumped over the lazy dog. It was cool.
line 2
line 3
line 4
line 5
</code></pre></div></div> <p>我们也可以指定一个需要用户确认的替换命令，通过添加一个 "c" 字符到这个命令的末尾来完成这个替换命令。</p> <p>例如：</p> <p><code class="language-plaintext highlighter-rouge">:%s/line/Line/gc </code></p> <p>这个命令会把我们的文件恢复先前的模样。然而，在执行每个替换命令之前，vi 会停下来，通过下面的信息，来要求我们确认这个替换。</p> <p><code class="language-plaintext highlighter-rouge">replace with Line (y/n/a/q/l/^E/^Y)? </code></p> <p>括号中的每个字符都是一个可能的选择，如下所示。</p> <table> <thead> <tr> <th style="text-align: center">按键</th> <th>行为</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">y</td> <td>执行替换操作</td> </tr> <tr> <td style="text-align: center">n</td> <td>跳过这个匹配的实例</td> </tr> <tr> <td style="text-align: center">a</td> <td>对这个及随后所有匹配的字符串执行替换操作</td> </tr> <tr> <td style="text-align: center">q 或者 esc</td> <td>退出替换操作</td> </tr> <tr> <td style="text-align: center">l</td> <td>执行这次替换并退出<br/>l 是 "last" 的简写</td> </tr> <tr> <td style="text-align: center">Ctrl-e, Ctrl-y</td> <td>分别是向下滚动和向上滚动<br/>用于查看建议替换的上下文</td> </tr> </tbody> </table> <p>如果你输入 y，则执行这个替换，输入 n 则会导致 vi 跳过这个实例，而移到下一个匹配项上。</p> <h2 id="heading-编辑多个文件">编辑多个文件</h2> <p>同时能够编辑多个文件是很有用的，你可能需要更改多个文件或者从一个文件复制内容到另一个文件。</p> <p>通过 vi，我们可以打开多个文件来编辑，只要在命令行中指定要编辑的文件名</p> <p><code class="language-plaintext highlighter-rouge">vi file1 file2 file3...</code></p> <p>我们先退出已经存在的 vi 会话，然后创建一个新文件来编辑。</p> <p>输入 :wq 来退出 vi 并且保存所做的修改。</p> <p>下一步，我们将在 home(家) 目录下创建一个额外用来玩耍的文件，通过获取从 ls 命令的输出，来创建这个文件</p> <p><code class="language-plaintext highlighter-rouge">ls -l /usr/bin &gt; ls-output.txt</code></p> <p>用 vi 来编辑我们的原文件和新创建的文件。</p> <p><code class="language-plaintext highlighter-rouge">vi foo.txt ls-output.txt</code></p> <p>vi 启动，我们会看到第一个文件显示出来。</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The quick brown fox jumped over the lazy dog. It was cool.
Line 2
Line 3
Line 4
Line 5
</code></pre></div></div> <h3 id="heading-文件之间转换">文件之间转换</h3> <p>从这个文件转到下一个文件，使用这个 ex 命令：</p> <p><code class="language-plaintext highlighter-rouge">:n</code></p> <p>回到先前的文件使用：</p> <p><code class="language-plaintext highlighter-rouge">:N</code></p> <p>当我们从一个文件移到另一个文件时，如果当前文件没有保存修改，vi 会阻止我们转换文件，这是 vi 强制执行的政策。</p> <p>在命令之后添加感叹号，可以强迫 vi 放弃修改而转换文件。</p> <p>另外，上面所描述的转换方法，vim (和一些版本的 vi) 也提供了一些 ex 命令，这些命令使多个文件更容易管理。</p> <p>我们可以使用 :buffers 命令查看正在编辑的文件列表。</p> <p>运行这个命令后，屏幕顶部就会显示出一个文件列表。</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:buffers
1 %a "foo.txt" line 1
2 "ls-output.txt" line 0
Press ENTER or type command to continue
</code></pre></div></div> <p>转换到其它缓冲区(文件), 输入 :buffers 缓冲区数字。</p> <p>例如，从包含 foot.txt 文件的缓冲区1，转换到包含 ls-output.txt 文件的缓冲区2，应该输入</p> <p><code class="language-plaintext highlighter-rouge">:buffer 2</code></p> <p>我们的屏幕上将会显示的是第二个文件。</p> <h3 id="heading-打开编辑额外的文件">打开编辑额外的文件</h3> <p>当我们正在编辑文件时，同样可以打开其它文件加入进来。</p> <p>ex 的 :e 命令("edit" 的缩写)后面跟着一个想要打开的额外文件名。</p> <p>我们先退出目前的编辑模式，返回到命令行，使用 vi 只打开一个文件：</p> <p><code class="language-plaintext highlighter-rouge">vi foo.txt</code></p> <p>添加第二个文件，输入命令：</p> <p><code class="language-plaintext highlighter-rouge">:e ls-output.txt</code></p> <p>它会显示在屏幕上，并且，通过验证，第一个文件仍然存在。</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:buffers
1 # "foo.txt" line 1
2 %a "ls-output.txt" line 0
Press ENTER or type command to continue
</code></pre></div></div> <p>注意：你不能通过 :n 或 :N 命令在由 :e 命令加载的文件之间进行切换。</p> <p>这时要使用 :buffer 命令，其后加上缓冲区号码，来转换文件。</p> <h3 id="heading-从一个文件复制内容到另一个文件">从一个文件复制内容到另一个文件</h3> <p>当我们编辑多个文件时，经常地要复制文件的一部分到另一个正在编辑的文件。</p> <p>使用之前我们学到的拉 (yank) 和粘贴命令，这很容易完成。</p> <p>以打开的两个文件为例，首先转换到缓冲区 1 (foo.txt)， 输入：</p> <p><code class="language-plaintext highlighter-rouge">:buffer 1</code></p> <p>我们应该得到以下输出：</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The quick brown fox jumped over the lazy dog. It was cool.
Line 2
Line 3
Line 4
Line 5
</code></pre></div></div> <p>下一步, 把光标移到第一行，并且输入 yy 来复制这一行。</p> <p>转换到第二个缓冲区, 输入：</p> <p><code class="language-plaintext highlighter-rouge">:buffer 2</code></p> <p>现在屏幕会包含一些文件列表 (这里只列出了一部分)：</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>total 343700
-rwxr-xr-x 1 root root 31316 2007-12-05 08:58 [
-rwxr-xr-x 1 root root 8240 2015-12-09 13:39 411toppm
-rwxr-xr-x 1 root root 111276 2016-01-31 13:36 a2p
-rwxr-xr-x 1 root root 25368 2014-10-06 20:16 a52dec
-rwxr-xr-x 1 root root 11532 2015-05-04 17:43 aafire
-rwxr-xr-x 1 root root 7292 2015-05-04 17:43 aainfo
</code></pre></div></div> <p>移动光标到第一行，输入 p 命令把我们从前面文件中复制的一行粘贴到这个文件中：</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>total 343700
The quick brown fox jumped over the lazy dog. It was cool.
-rwxr-xr-x 1 root root 31316 2015-12-05 08:58 [
-rwxr-xr-x 1 root root 8240 2015-12-09 13:39 411toppm
-rwxr-xr-x 1 root root 111276 2016-01-31 13:36 a2p
-rwxr-xr-x 1 root root 25368 2014-10-06 20:16 a52dec
-rwxr-xr-x 1 root root 11532 2015-05-04 17:43 aafire
-rwxr-xr-x 1 root root 7292 2015-05-04 17:43 aainfo
</code></pre></div></div> <h3 id="heading-插入整个文件到另一个文件">插入整个文件到另一个文件</h3> <p>也有可能把整个文件插入到我们所编辑的文件中。</p> <p>看一下实际操作，结束 vi 会话，重新启动一个只打开一个文件的 vi 会话。</p> <p><code class="language-plaintext highlighter-rouge">vi ls-output.txt</code></p> <p>再一次看到我们的文件列表：</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>total 343700
-rwxr-xr-x 1 root root 31316 2015-12-05 08:58 [
-rwxr-xr-x 1 root root 8240 2015-12-09 13:39 411toppm
-rwxr-xr-x 1 root root 111276 2016-01-31 13:36 a2p
-rwxr-xr-x 1 root root 25368 2014-10-06 20:16 a52dec
-rwxr-xr-x 1 root root 11532 2015-05-04 17:43 aafire
-rwxr-xr-x 1 root root 7292 2015-05-04 17:43 aainfo
</code></pre></div></div> <p>移动光标到第三行，然后输入以下 ex 命令：</p> <p><code class="language-plaintext highlighter-rouge">:r foo.txt</code></p> <p>这个 :r 命令 (是 "read" 的简称) 把指定的文件插入到光标位置之前。</p> <p>现在屏幕应该看起来像这样：</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>total 343700
-rwxr-xr-x 1 root root 31316 2015-12-05 08:58 [
-rwxr-xr-x 1 root root 8240 2015-12-09 13:39 411toppm
The quick brown fox jumped over the lazy dog. It was cool.
Line 2
Line 3
Line 4
Line 5
-rwxr-xr-x 1 root root 111276 2016-01-31 13:36 a2p
-rwxr-xr-x 1 root root 25368 2014-10-06 20:16 a52dec
-rwxr-xr-x 1 root root 11532 2015-05-04 17:43 aafire
-rwxr-xr-x 1 root root 7292 2015-05-04 17:43 aainfo
</code></pre></div></div> <h2 id="heading-保存工作">保存工作</h2> <p>像 vi 中的其它操作一样，有几种不同的方法来保存我们所修改的文件。</p> <p>我们已经研究了 :w 这个 ex 命令, 但还有几种方法，可能我们也觉得有帮助，在命令模式下，输入 ZZ 就会保存并退出当前文件。</p> <p>同样地, ex 命令 :wq 把 :w 和 :q 命令结合到一起来完成保存和退出任务。</p> <p>这个 :w 命令也可以指定可选的文件名。</p> <p>这个的作用就如 "另存为"。</p> <p>例如，如果我们正在编辑 foo.txt 文件，想要保存一个副本，叫做 foo1.txt，那么我们可以执行以下命令</p> <p><code class="language-plaintext highlighter-rouge">:w foo1.txt</code></p> <p>注意：当上面的命令以一个新名字保存文件时，但它并没有更改你正在编辑的文件的名字，如果你继续编辑的话，你还是在编辑文件 foo.txt，而不是 foo1.txt。</p> <h2 id="heading-拓展阅读">拓展阅读</h2> <p>即使把这章所学的内容都加起来，我们也只是学了 vi 和 vim 的一点儿皮毛而已。</p> <p>这里有一些在线的资料，你可以用来继续 vi 学习之旅。</p> <ul> <li> <p>学习 vi 编辑器－一本来自于 Wikipedia 的 Wikibook, 是一本关于 vi 的简要指南, 并介绍了几个类似 vi 的程序, 其中包括 vim。</p> <p>它可以在下面链接中得到:</p> <p><a href="http://en.wikibooks.org/wiki/Vi">http://en.wikibooks.org/wiki/Vi</a></p> </li> <li> <p>The Vim Book － vim 项目, 一本 570 页的书籍, 包含了(几乎)所有的 vim 特性。</p> <p>你能在下面链接中找到它:</p> <p><a href="ftp://ftp.vim.org/pub/vim/doc/book/vimbook-OPL.pdf">ftp://ftp.vim.org/pub/vim/doc/book/vimbook-OPL.pdf</a></p> </li> <li> <p>Wikipedia 上关于 vi 的创始人 Bill Joy 的文章:</p> <p><a href="http://en.wikipedia.org/wiki/Bill_Joy">http://en.wikipedia.org/wiki/Bill_Joy</a></p> </li> <li> <p>Wikipedia 上关于 vim 的作者 Bram Moolenaar 的文章:</p> <p><a href="http://en.wikipedia.org/wiki/Bram_Moolenaar">http://en.wikipedia.org/wiki/Bram_Moolenaar</a></p> </li> </ul> <hr/> <p>参考:</p> <p><a href="https://github.com/happypeter/TLCL">happypeter/TLCL</a></p> <p><a href="http://www.linuxcommand.org/tlcl.php">The Linux Command Line</a></p> </div> </div> </div> <footer class="unit-foot"> <div class="unit-inner unit-foot-inner"> <div class="post-buttons"> <a class="internal gotop" href="#page" title="返回顶部">返回顶部</a> <div class="addthis_toolbox addthis_default_style addthis_32x32_style"> <small class="label">分享本文：</small> <a class="btn-share-post addthis_button_email"></a> <a class="btn-share-post addthis_button_facebook"></a> <a class="btn-share-post addthis_button_google_plusone_share"></a> <a class="btn-share-post addthis_button_reddit"></a> <a class="btn-share-post addthis_button_twitter"></a> </div> <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5fd67ed699f02738"></script> </div> <nav class="pagination"> <a class="internal" rel="prev" href="/2017/12/19/graceful-sentences/" title="上一篇 '佳句'"> ← 佳句</a> <a class="internal" rel="next" href="/2018/03/25/sushu/" title="下一篇 '素书'">素书 → </a> </nav> </div> </footer> <div class="misc-content"> <script>$(document).ready(function(){var b="CefuUqy9qWjTPQyiiLRTCFkFAOl7FIXLjBHyIdpFqMFDFYgqYgOHvaJIZXybCUV4";var c="fighting-v";var a="link:"+$(".comments .show-hidden").attr("data-disqus-url");$.ajax({type:"GET",url:"//disqus.com/api/3.0/threads/set.jsonp",data:{api_key:b,forum:c,thread:a},cache:false,dataType:"jsonp",success:function(d){if(d.response.length===1){btnText="显示评论 ("+d.response[0].posts+")";$(".comments .show-hidden").html(btnText)}}});$(".comments .show-hidden").on("click",function(){$.ajaxSetup({cache:true});$.getScript("//"+c+".disqus.com/embed.js");$.ajaxSetup({cache:false});$(this).remove()});if(/\#comments/.test(location.hash)){$(".comments .show-hidden").trigger("click")}});</script> <div class="comments"> <button class="center-block show-hidden" title="显示评论" data-disqus-url="https://empvalley.com/2018/03/09/vi-commands/">显示评论</button> <div id="disqus_thread"></div> </div> </div> </div> </div> </article> </div> </div> </div> </div> <footer class="the-footer"> <div class="unit-foot"> <div class="unit-inner unit-foot-inner"> <div class="misc vcard"> <div class="about"> <h4><a href="/">关于</a></h4> <p>晨霜，软件开发，深圳</p> <p><small>本博客主题 <a href="https://github.com/yizeng/jekyll-theme-simple-texture" target="_blank">Simple Texture</a> 由 <a href="http://yizeng.me" target="_blank">Yi Zeng</a> 基于 <a href="https://jekyllrb.com/" target="_blank">Jekyll</a> 开发.</small></p> </div> <div class="social-links"> <a class="ico-rss" href="/feed.xml" rel="me" target="_blank" title="feed"></a> <a class="ico-github" href="https://github.com/v191211/" rel="me" target="_blank" title="github"></a> <a class="ico-linkedin" href="https://www.linkedin.com/in/fighting-v/" rel="me" target="_blank" title="linkedin"></a> <a class="ico-stackoverflow" href="https://stackoverflow.com/users/4612522/adam-smith" rel="me" target="_blank" title="stackoverflow"></a> </div> </div> </div> </div> <a href="#" class="internal back-to-top">返回顶部</a> </footer> </div> <script>$(document).ready(function(){var c=50,b=500,a=960;$(window).scroll(function(){if($(window).width()>a){if($(this).scrollTop()>c){$("footer").css("top","20px");$("footer .back-to-top").fadeIn(b)}else{$("footer").css("top","auto");$("footer .back-to-top").fadeOut(b)}}});$(window).resize(function(){if($(window).width()<a){$("footer").css("top","auto");$("footer .back-to-top").fadeOut(b)}if($(window).width()>=a&&$(this).scrollTop()>c){$("footer").css("top","20px");$("footer .back-to-top").fadeIn(b)}});$("footer .back-to-top, .gotop").on("click",function(d){d.preventDefault();$("html, body").animate({scrollTop:0},b);return false});$(".show-hidden").on("click",function(){$(this).parent().next().toggleClass("hidden");$(this).toggleClass("hidden")})});</script> <script src="/assets/javascripts/jekyll-search.jquery.js"></script> <script>$(document).ready(function(){$(".search-field").simpleJekyllSearch({jsonFile:"/search.json",template:'<li><a href="{url}">{title} <span class="entry-date"><time datetime="{date}">{shortdate}</time></span></a></li>',searchResults:".search-wrapper .results",searchResultsTitle:"<h4>搜索结果</h4>",noResults:"<p>啊哈<br/><small>什么也没找到 :(</small></p>"})});(function(c,b,d){var a=function(){c(".nav-wrapper, .search-wrapper").removeAttr("style");c(".nav-form, .search-form").removeClass("active");c("body").removeClass("nav-overlay search-overlay")};c(".nav-global .btn-search").on("click",function(){c(".search-wrapper").css({display:"block"});c(".search-form").addClass("active");c(".search-form").find("input").focus();c("body").addClass("search-overlay")});c(".nav-global .btn-menu").on("click",function(){c(".nav-wrapper").css({display:"block"});c(".nav-form").addClass("active");c(".nav-form .search-field").prop("disabled",true);c("body").addClass("nav-overlay")});c(".nav-wrapper .btn-close, .search-wrapper .btn-close").on("click",function(){a()});c(document).on("keyup",function(f){if(f.keyCode===27){a()}})})(jQuery,window);</script> <script src='//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.js'></script> <script src='//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-buttons.min.js'></script> <script src="/assets/javascripts/unveil/jquery.unveil.min.js"></script> <script>window.jQuery.fancybox||document.write('<script src="/assets/javascripts/fancybox/jquery.fancybox.pack.js?v=2.1.4"><\/script>');window.jQuery.fancybox.helpers.buttons||document.write('<script src="/assets/javascripts/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"><\/script>');</script> <script>$("head").append('<link rel="stylesheet" href="/assets/javascripts/fancybox/jquery.fancybox.css?v=2.1.4" type="text/css" />');$("head").append('<link rel="stylesheet" href="/assets/javascripts/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" />');$(".post-image").fancybox({prevEffect:"none",nextEffect:"none",closeBtn:true,helpers:{title:{type:"float"}}});$(document).ready(function(){$(".post-image > img").unveil(450)});</script> </body> </html>